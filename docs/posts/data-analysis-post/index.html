<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Mauricio Patón">
<meta name="dcterms.date" content="2023-01-12">

<title>Mauricio Patón - Data analysis to evaluate the hospitalisation risk between SARS-CoV-2 Variants</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script src="../../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Mauricio Patón</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html" rel="" target="">
 <span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resume.html" rel="" target="">
 <span class="menu-text">Resume</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../Mauricio-CV-DS.html" rel="" target="">
 <span class="menu-text">Quarto-CV</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Data analysis to evaluate the hospitalisation risk between SARS-CoV-2 Variants</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
                                <div class="quarto-categories">
                <div class="quarto-category">code</div>
                <div class="quarto-category">analysis</div>
                <div class="quarto-category">covid19</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Mauricio Patón </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 12, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a>
  <ul class="collapse">
  <li><a href="#sampling-issues" id="toc-sampling-issues" class="nav-link" data-scroll-target="#sampling-issues"><span class="header-section-number">1.1</span> Sampling Issues</a></li>
  <li><a href="#cleaning-data-procedure" id="toc-cleaning-data-procedure" class="nav-link" data-scroll-target="#cleaning-data-procedure"><span class="header-section-number">1.2</span> Cleaning data procedure</a>
  <ul class="collapse">
  <li><a href="#summary-of-main-lineages-after-re-labeling" id="toc-summary-of-main-lineages-after-re-labeling" class="nav-link" data-scroll-target="#summary-of-main-lineages-after-re-labeling"><span class="header-section-number">1.2.1</span> Summary of main lineages after re-labeling</a></li>
  <li><a href="#clean-duplicate-eids" id="toc-clean-duplicate-eids" class="nav-link" data-scroll-target="#clean-duplicate-eids"><span class="header-section-number">1.2.2</span> Clean Duplicate EIDs</a></li>
  </ul></li>
  <li><a href="#comparison-between-sequenced-and-non-sequenced-samples" id="toc-comparison-between-sequenced-and-non-sequenced-samples" class="nav-link" data-scroll-target="#comparison-between-sequenced-and-non-sequenced-samples"><span class="header-section-number">1.3</span> Comparison between sequenced and non-sequenced samples</a>
  <ul class="collapse">
  <li><a href="#age-group-distribution-of-sequenced-and-non-sequenced-samples" id="toc-age-group-distribution-of-sequenced-and-non-sequenced-samples" class="nav-link" data-scroll-target="#age-group-distribution-of-sequenced-and-non-sequenced-samples"><span class="header-section-number">1.3.1</span> Age group distribution of sequenced and non-sequenced samples</a></li>
  <li><a href="#samples-distributed-by-reason-for-sequencing" id="toc-samples-distributed-by-reason-for-sequencing" class="nav-link" data-scroll-target="#samples-distributed-by-reason-for-sequencing"><span class="header-section-number">1.3.2</span> Samples distributed by reason for sequencing</a></li>
  <li><a href="#sample-distribution-based-on-nationality" id="toc-sample-distribution-based-on-nationality" class="nav-link" data-scroll-target="#sample-distribution-based-on-nationality"><span class="header-section-number">1.3.3</span> Sample distribution based on nationality</a></li>
  <li><a href="#samples-for-comorbidities-of-sequenced-and-non-sequenced" id="toc-samples-for-comorbidities-of-sequenced-and-non-sequenced" class="nav-link" data-scroll-target="#samples-for-comorbidities-of-sequenced-and-non-sequenced"><span class="header-section-number">1.3.4</span> Samples for comorbidities of sequenced and non-sequenced</a></li>
  <li><a href="#samples-distributed-by-lab" id="toc-samples-distributed-by-lab" class="nav-link" data-scroll-target="#samples-distributed-by-lab"><span class="header-section-number">1.3.5</span> Samples distributed by lab</a></li>
  </ul></li>
  <li><a href="#distribution-of-samples-over-time" id="toc-distribution-of-samples-over-time" class="nav-link" data-scroll-target="#distribution-of-samples-over-time"><span class="header-section-number">1.4</span> Distribution of samples over time</a>
  <ul class="collapse">
  <li><a href="#number-of-cases-sequenced-by-lineage" id="toc-number-of-cases-sequenced-by-lineage" class="nav-link" data-scroll-target="#number-of-cases-sequenced-by-lineage"><span class="header-section-number">1.4.1</span> Number of cases sequenced by lineage</a></li>
  <li><a href="#number-of-hospitalizations" id="toc-number-of-hospitalizations" class="nav-link" data-scroll-target="#number-of-hospitalizations"><span class="header-section-number">1.4.2</span> Number of hospitalizations</a></li>
  <li><a href="#number-of-deaths" id="toc-number-of-deaths" class="nav-link" data-scroll-target="#number-of-deaths"><span class="header-section-number">1.4.3</span> Number of deaths</a></li>
  </ul></li>
  <li><a href="#summary-table-of-totals" id="toc-summary-table-of-totals" class="nav-link" data-scroll-target="#summary-table-of-totals"><span class="header-section-number">1.5</span> Summary table of totals</a></li>
  <li><a href="#time-evolution-of-daily-cases-curve" id="toc-time-evolution-of-daily-cases-curve" class="nav-link" data-scroll-target="#time-evolution-of-daily-cases-curve"><span class="header-section-number">1.6</span> Time evolution of daily cases curve</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>In this report, an analysis of the data to be used to estimate epidemiological parameters for the different SARS-CoV-2 lineages of interest (e.g.: BA.1, B.1.629, etc.) is presented. Firstly, the data is cleaned to ensure that no duplicates, and proper lineages are used. Then, the data analysis is conducted. In particular, the analysis is focused on the identification of potential biases in the data as it compares people who were sequenced against people who were not sequenced.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Due to confidentiality issues, the results have been masked in this document accordingly.</p>
<p>The data displayed in the figures, tables and text are shown for illustrative purposes and do not reflect real numbers.</p>
</div>
</div>
<section id="sampling-issues" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="sampling-issues"><span class="header-section-number">1.1</span> Sampling Issues</h2>
<p>The <a href="">sampling strategy followed in the United Arab Emirates</a> from <u><strong>January 1st, 2022</strong></u> comprised the sequencing of samples from individuals that belonged to one of the following groups:</p>
<ol type="1">
<li>All people in ICU/HDU and/or deceased.</li>
<li>All people who entered through a port of entry and had a positive PCR.</li>
<li>The rest of the infected people were sequenced based on a random sample proportionally to the number of positives reported by each lab on a weekly basis.</li>
</ol>
<p>Sampling prior to the stated day needs to be double-checked for proper interpretation.</p>
<p>The sampling strategy described follows WHO recommendation. Therefore, it might be of interest to develop a methodology in which an unbiased (or systematically low bias) estimator of the sample is found after following WHO recommendations for sampling COVID-19 patients.</p>
<p>First, we are going to load the dataset and examine it:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   2535161 obs. of  34 variables:
 $ PseudoID                   : chr  "{FA0C53C0-82F7-4803-AF51-F555BA559850}" "{FF55A071-A266-4A57-BE88-F555BA825A10}" "{973E11D1-51F1-4069-96D7-F55625907981}" "{B37D192F-AA2C-4812-890B-F5573B6873D2}" ...
 $ Lineage                    : chr  "B.1.617.2" "" "B.1.617.2" "" ...
 $ CollectionDateTime         : chr  "2021-11-24 00:00:00" "2022-08-08 00:00:00" "2021-06-09 00:00:00" "2022-06-08 00:00:00" ...
 $ Dose1_Vaccine_Type         : chr  "Pfizer" "Pfizer" "" "Sinopharm" ...
 $ Dose1_VaccinationDate      : chr  "2022-03-13" "2021-09-15" "" "2021-05-02" ...
 $ Dose2_Vaccine_Type         : chr  "" "Pfizer" "" "Sinopharm" ...
 $ Dose2_VaccinationDate      : chr  "" "2021-10-06" "" "2021-05-23" ...
 $ Dose3_Vaccine_Type         : chr  "" "" "" "Sinopharm" ...
 $ Dose3_VaccinationDate      : chr  "" "" "" "2021-12-21" ...
 $ Dose4_Vaccine_Type         : chr  "" "" "" "" ...
 $ Dose4_VaccinationDate      : chr  "" "" "" "" ...
 $ VaccinationStatus          : chr  "NotVaccincated" "Full" "NotVaccincated" "Full" ...
 $ NoOfDoses                  : int  1 2 0 3 0 3 3 0 3 3 ...
 $ LineageHospitalized        : int  0 1 0 0 0 0 0 0 0 0 ...
 $ IsDied                     : int  0 0 0 0 0 0 0 0 0 0 ...
 $ Death_Date                 : chr  "" "" "" "" ...
 $ LOS                        : int  NA 12 2 NA NA NA NA NA NA NA ...
 $ hospital_discharge_date    : chr  "" "2022-08-22 11:59:00" "2022-12-21 13:28:00" "" ...
 $ Date_hospitalization       : chr  "" "2022-08-10 18:11:00.000" "2022-12-19 09:23:43.000" "" ...
 $ Covid_Variant              : chr  "Delta" "" "Delta" "" ...
 $ Gender                     : chr  "Male" "Male" "Female" "Male" ...
 $ Nationality                : chr  "Expatraite" "PHILIPPINES" "UNITED ARAB EMIRATES" "UNITED ARAB EMIRATES" ...
 $ LineageRecorded            : chr  "" "" "" "" ...
 $ Comorbities                : int  0 0 0 0 0 0 0 0 0 0 ...
 $ PriorInfection             : int  NA NA 1 NA NA NA NA NA 1 1 ...
 $ PriorInfection_Count       : int  NA NA 4 NA NA NA NA NA 2 2 ...
 $ Band15Years                : chr  "15-29" "30-44" "60+" "45-59" ...
 $ Tableau_ICU_Status         : chr  "Others" "" "Others" "" ...
 $ Tableau_Travel_Country_Name: chr  "" "No" "UNKNOWN" "No" ...
 $ Performing.Facility        : chr  "TW Tawam Hospital" "Mediclinic" "" "" ...
 $ Sequenced                  : chr  "1" "0" "1" "0" ...
 $ AGE                        : chr  "21" "33" "87" "49" ...
 $ CASES                      : chr  "146" "1475" "4254" "4052" ...
 $ TESTED                     : int  182946 173947 144956 165451 178620 277402 260176 123265 298367 248765 ...</code></pre>
</div>
</div>
<p>As we see, we have information per patient for the following variables:</p>
<ul>
<li><code>PseudoID</code>: Unique identifier for each patient.</li>
<li><code>Lineage</code>: Identification of the lineage sequenced.</li>
<li><code>CollectionDateTime</code>: Date and time in which the PCR sample was collected for the infected patient.</li>
<li><code>Dose_VaccinationDate</code>: Date in which the vaccination of the dose referred was taken.</li>
<li><code>Dose_Vaccine_Type</code>: Type of vaccine that was taken.</li>
<li><code>Vaccination Status</code>: Fully vaccinated if the individual got at least two doses or unvaccinated.</li>
<li><code>NoOfDoses</code>: Number of vaccine doses received per individual.</li>
<li><code>LineageHospitalized</code>: Identification of hospitalization for the patient who was sequenced.</li>
<li><code>IsDied</code>: Identification of death for the patient.</li>
<li><code>Death_Date</code>: Date in which the patient died.</li>
<li><code>LOS</code>: Length of stay in the hospital.</li>
<li><code>Hospital_Discharge_date</code>: Date in which the patient was discharged.</li>
<li><code>Date_hospitalization</code>: Date in which the patient was admitted.</li>
<li><code>Gender</code>: Male or Female.</li>
<li><code>Nationality</code>: Expatriate or Local.</li>
<li><code>Covid_Variant</code>: Recoding of the variant of the COVID Lineage.</li>
<li><code>Comorbidities</code>: Number of comorbidities per patient.</li>
<li><code>PriorInfection</code>: Flag if the patient registered a prior infection before the current positive.</li>
<li><code>PriorInfection_Count</code>: Number of previous infections registered.</li>
<li><code>Age</code>: Age of the patient.</li>
<li><code>Band15Years</code>: Age group of 15 years old for the patient.</li>
<li><code>Sequenced</code>: Identification for patients that were sequenced or not sequenced.</li>
<li><code>Performing.Facility</code>: Lab conducting the collection of the sample that was sequencing. <em>This field will be used to estimate the population properties of those that were randomly sequenced. In particular, checking the randomness assumption is a goal of the work presented in this document. (Group 3)</em></li>
<li><code>Tableau_ICU_Status</code>: Label if the patient is ICU/HDU or dead. <em>This field will be used to label the patients as HDU/ICU pr dead as reason per sequencing. All patients labeled in this field were sequenced. (Group 1)</em></li>
<li><code>Tableau_Travel_Country_Name</code>: Travel history of the positive patient in the last XX days. <em>This field will be used to label those patients who tested positive and had a travel history according to the IDN and PRP databases. (Group 2)</em></li>
</ul>
</section>
<section id="cleaning-data-procedure" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="cleaning-data-procedure"><span class="header-section-number">1.2</span> Cleaning data procedure</h2>
<p>Firstly, we need to clean the data to ensure that the data is of a good enough quality and no double-counting occurs. In particular we are going to focus on three aspects:</p>
<ol type="1">
<li><p>Re-code lineage into relevant variants. In particular:</p>
<p>a. Rename AY.XX into parent lineage Delta B.1.659.2.</p>
<p>b. Rename all BA.X.X into the parent lineage BA.X (e.g.&nbsp;BA.1.1 is renamed as BA.1).</p>
<p>c. Rename variant B.1.1.529 as BA.1 as per this <a href="https://gvn.org/omicron-b-1-1-529/">description</a>.</p></li>
<li><p>Fix records in which age is not defined by retrieving the age from the year of birth from the Emirates ID.</p></li>
</ol>
<ol start="3" type="1">
<li><p>Remove invalid records, namely:</p>
<p>a. EIDs that are invalid and do not correspond to any record (5145 records).</p>
<p>b. Records with lineage labeled as <code>Jul 25 2022 12:00AM</code> (2033 records).</p>
<p>c.&nbsp;Records with a <code>CollectionDateTime</code> before February 1st, 2020 (6 records).</p></li>
<li><p>Remove duplicate IDs covering the same infection case are present in the database (e.g.&nbsp;two EIDs for the same date labeled the lineage as BA.2 and BA.2.1).</p></li>
<li><p>Select for the patients sequenced only those whose lineage sequenced have at least more than <strong>500 records</strong>.</p></li>
<li><p>Check also how many records labeled as non-sequenced have a lab assigned according to the dashboard data from ADPHC.</p></li>
</ol>
<p>Once the data is cleaned, we can summarize the number of cases per variant recorded and compare it to the values published by ADPHC.</p>
<section id="summary-of-main-lineages-after-re-labeling" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="summary-of-main-lineages-after-re-labeling"><span class="header-section-number">1.2.1</span> Summary of main lineages after re-labeling</h3>
<p>Lineages in the dataset appear with multiple names. Some of those lineages were recorded with multiple names. In the original dataset there are 1000 different variants labeled. Some of the reasons for so many sublineages defined registered were</p>
<ul>
<li>All sublineages were registered (e.g.: BA.2.40, BA.2.75)</li>
<li>The mutation of the sublineage was labeled registered (e.g.: AY.17 (S:D1118Y))<br>
</li>
<li>Some sublineages contain a certain description (e.g.&nbsp;BA.2 (Recombinant?))</li>
<li>Some sublineages are double coded (e.g.: “Delta/B.1.617.2”)</li>
<li>Some sublineages were wrongly labeled (e.g.: ~2000 records with “Jul 25 2022 12:00AM” as lineage)</li>
</ul>
<p>Therefore, an aggregation criteria needs to be defined. For the purposes of this report, the following criteria was used:</p>
<ul>
<li>Description of mutations were removed (e.g.&nbsp;AY.17 (S:D1118Y) becomes AY.17)</li>
<li>All variants were re-defined to their main sub-lineages (e.g.: AY.17 or AY.103 were redefined as B.1.617.2).</li>
<li>Double labeling was defined as per the lineage name (e.g.:Delta/B.1.617.2 was coded as B.1.617.2).</li>
<li>Variant B.1.1.529 was renamed as BA.1.</li>
<li>All records with lineage labeled as “Jul 25 2022 12:00AM” were removed.</li>
</ul>
<p>After the re-coding of the lineages in the databases, the number of records for each lineage (for those lineages that contained more than 500 records) is shown in Figure @ref(fig:check-recoded-lineages). It is important to note that this distribution is done with the raw data before removing duplicates in the data.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/check-recoded-lineages-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Number of records per lineage before removal of duplicates.</figcaption>
</figure>
</div>
</div>
</div>
<p>Once lineages have been re-coded and the data cleaned from invalid records, we can move into the removal of duplicates.</p>
</section>
<section id="clean-duplicate-eids" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="clean-duplicate-eids"><span class="header-section-number">1.2.2</span> Clean Duplicate EIDs</h3>
<p>After recoding lineages and fixing the records that were considered as invalid, the next step consists of cleaning the data by removing all the duplicates.</p>
<p>Firstly, We check the number of duplicate IDs appearing in the database. This is shown in <strong>?@tbl-duplicate-ids-check</strong> or Table @ref(tab:duplicate-ids-check):</p>
<div class="cell">
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:100%; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<caption>Number of records per ID number of the 10 most repeated records in the database.</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">PseudoID</th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"># records</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; position: absolute;">{6BFEAEC8-A945-48B5-B87B-59E8E6F64435}</td>
<td style="text-align: center;">340</td>
</tr>
<tr class="even">
<td style="text-align: left; position: absolute;">{20A622C3-06CB-4E9D-86E0-0632490450B6}</td>
<td style="text-align: center;">144</td>
</tr>
<tr class="odd">
<td style="text-align: left; position: absolute;">{37D050C7-4927-4AC6-B43E-6631A462EC3D}</td>
<td style="text-align: center;">140</td>
</tr>
<tr class="even">
<td style="text-align: left; position: absolute;">{B3BA3F02-9D09-42A4-AF4F-8DEC36CE5007}</td>
<td style="text-align: center;">140</td>
</tr>
<tr class="odd">
<td style="text-align: left; position: absolute;">{080D687A-A6E6-4BC1-9098-EE740BEE0EC9}</td>
<td style="text-align: center;">120</td>
</tr>
<tr class="even">
<td style="text-align: left; position: absolute;">{492A371D-3629-455E-9FE2-8760C6B1783F}</td>
<td style="text-align: center;">120</td>
</tr>
<tr class="odd">
<td style="text-align: left; position: absolute;">{74E26468-4BF9-4503-BAE4-785942560BED}</td>
<td style="text-align: center;">120</td>
</tr>
<tr class="even">
<td style="text-align: left; position: absolute;">{9DC90E03-1C5A-40F0-8330-3BDD7DE5D57D}</td>
<td style="text-align: center;">120</td>
</tr>
<tr class="odd">
<td style="text-align: left; position: absolute;">{C9EEA6BA-0D32-4BC1-9E4E-5A4E550689DE}</td>
<td style="text-align: center;">120</td>
</tr>
<tr class="even">
<td style="text-align: left; position: absolute;">{F80A583E-AC85-4C45-9F75-823AD0592E87}</td>
<td style="text-align: center;">120</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<p>As we see in the summary table, there are many patients that are repeated in the records (as many as 340 times).</p>
<p>For example, we can see the different labels for a given patient in Table @ref(tab:patient-multiple-records):</p>
<div class="cell">
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:100%; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<caption>Different records for the same infection(s) for patient with PseudoID</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">CollectionDateTime</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Nationality</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Age</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Lineage.Short</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Tableau_Travel_Country_Name</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Tableau_ICU_Status</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Performing.Facility</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Sequenced</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; position: absolute;">2021-12-25 00:00:00</td>
<td style="text-align: left;">Expatraite</td>
<td style="text-align: right;">30</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Others</td>
<td style="text-align: left;">Danat Al Emarat Hospital</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="even">
<td style="text-align: left; position: absolute;">2021-12-25 00:00:00</td>
<td style="text-align: left;">Expatraite</td>
<td style="text-align: right;">31</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Others</td>
<td style="text-align: left;">Danat Al Emarat Hospital</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left; position: absolute;">2021-12-25 00:00:00</td>
<td style="text-align: left;">MOROCCO</td>
<td style="text-align: right;">30</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Others</td>
<td style="text-align: left;">Pure Health</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="even">
<td style="text-align: left; position: absolute;">2021-12-25 00:00:00</td>
<td style="text-align: left;">MOROCCO</td>
<td style="text-align: right;">30</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Others</td>
<td style="text-align: left;">Pure Health</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left; position: absolute;">2021-12-25 00:00:00</td>
<td style="text-align: left;">Expatraite</td>
<td style="text-align: right;">31</td>
<td style="text-align: left;">BA.1</td>
<td style="text-align: left;">SERBIA</td>
<td style="text-align: left;">Others</td>
<td style="text-align: left;">Danat Al Emarat Hospital</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left; position: absolute;">2022-06-12 00:00:00</td>
<td style="text-align: left;">MOROCCO</td>
<td style="text-align: right;">30</td>
<td style="text-align: left;">BA.5</td>
<td style="text-align: left;">UNKNOWN</td>
<td style="text-align: left;">Others</td>
<td style="text-align: left;">Pure Health</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left; position: absolute;">2021-12-25 00:00:00</td>
<td style="text-align: left;">Expatraite</td>
<td style="text-align: right;">30</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Others</td>
<td style="text-align: left;">Pure Health</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="even">
<td style="text-align: left; position: absolute;">2021-12-25 00:00:00</td>
<td style="text-align: left;">Expatraite</td>
<td style="text-align: right;">31</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Others</td>
<td style="text-align: left;">Pure Health</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left; position: absolute;">2021-12-25 00:00:00</td>
<td style="text-align: left;">MOROCCO</td>
<td style="text-align: right;">31</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Others</td>
<td style="text-align: left;">Danat Al Emarat Hospital</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="even">
<td style="text-align: left; position: absolute;">2021-12-25 00:00:00</td>
<td style="text-align: left;">MOROCCO</td>
<td style="text-align: right;">31</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Others</td>
<td style="text-align: left;">Danat Al Emarat Hospital</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left; position: absolute;">2021-12-28 00:00:00</td>
<td style="text-align: left;">MOROCCO</td>
<td style="text-align: right;">31</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Unknown</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0</td>
</tr>
<tr class="even">
<td style="text-align: left; position: absolute;">2022-06-12 00:00:00</td>
<td style="text-align: left;">Expatraite</td>
<td style="text-align: right;">30</td>
<td style="text-align: left;">BA.5</td>
<td style="text-align: left;">UNKNOWN</td>
<td style="text-align: left;">Others</td>
<td style="text-align: left;">Pure Health</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left; position: absolute;">2022-06-12 00:00:00</td>
<td style="text-align: left;">Expatraite</td>
<td style="text-align: right;">30</td>
<td style="text-align: left;">BA.5</td>
<td style="text-align: left;">UNKNOWN</td>
<td style="text-align: left;">Others</td>
<td style="text-align: left;">Pure Health</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left; position: absolute;">2022-06-12 00:00:00</td>
<td style="text-align: left;">Expatraite</td>
<td style="text-align: right;">30</td>
<td style="text-align: left;">BA.5</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Others</td>
<td style="text-align: left;">Pure Health</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left; position: absolute;">2022-06-12 00:00:00</td>
<td style="text-align: left;">Expatraite</td>
<td style="text-align: right;">31</td>
<td style="text-align: left;">BA.5</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Others</td>
<td style="text-align: left;">Pure Health</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left; position: absolute;">2022-06-12 00:00:00</td>
<td style="text-align: left;">MOROCCO</td>
<td style="text-align: right;">30</td>
<td style="text-align: left;">BA.5</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Others</td>
<td style="text-align: left;">Pure Health</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left; position: absolute;">2022-06-12 00:00:00</td>
<td style="text-align: left;">MOROCCO</td>
<td style="text-align: right;">30</td>
<td style="text-align: left;">BA.5</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Others</td>
<td style="text-align: left;">Pure Health</td>
<td style="text-align: left;">1</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<p>Therefore it looks like many patients are registered as repeated cases for the same infection episode. Those patients had differences in the label in the following fields:</p>
<ul>
<li>Variant names (e.g.&nbsp;BA.1 and BA.1.1 for the same patient - not shown in table after recoding.</li>
<li>Collection dates (e.g.&nbsp;patient collection date was 7/2/2021 and 8/2/2021).</li>
<li>Different values for <code>Tableau_Country_Names</code> (e.g.&nbsp;Yes/No/Country name).</li>
<li>Infection episodes (e.g.&nbsp;one infection in 30/07/2021 and 01/02/2022).</li>
</ul>
<p>Therefore, we need an additional aggregation step to identify each infection episode as a unique record. The following steps were followed to fix this issue with duplicate EIDs:</p>
<ol type="1">
<li>Identify each episode of infection within <strong>30 days</strong> as one infection episode.</li>
<li>Define Collection Date as the first date in which the sample of the infected individual was collected</li>
<li>Fill the nationality field with the record that contains a nationality</li>
<li>Fill the lineage field with the first record of the patient that contains a proper lineage</li>
<li>Create a <code>Travel.Country</code> field in which to register the country name (if available) for the given ID.</li>
<li>Create a <code>Travel.History</code> field in which to register the labels Yes/No/Unknown for the given ID.</li>
<li>Create a <code>Traveled</code> field with Yes/No if there is a valid field in Travel.Country or Travel.History (e.g.&nbsp;patient with empty field in Travel.History but with Travel.Country label). This means that those patients with travel history unknown and/or travel country name as unknown were considered as non-travelers.</li>
<li>Register the first non-empty field for Tableau_ICU_Status.</li>
<li>Register the first non-empty field for Performing Facility for sequenced patients (when available).</li>
</ol>
<p>After cleaning the data, we can check how many times a person is repeated in Table @ref(tab:duplicate-ids-cleaned-check).</p>
<div class="cell">
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:100%; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<caption>Number of records per ID number of the 10 most repeated records in the database.</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">PseudoID</th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;"># records</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; position: absolute;">{92E11469-6664-4C51-B14B-45C1844C6761}</td>
<td style="text-align: center;">6</td>
</tr>
<tr class="even">
<td style="text-align: left; position: absolute;">{53E1C60B-BDD6-4A59-85D4-3152AF8FE89F}</td>
<td style="text-align: center;">5</td>
</tr>
<tr class="odd">
<td style="text-align: left; position: absolute;">{763E6F05-FA36-4203-B78B-58DB686BEC1E}</td>
<td style="text-align: center;">5</td>
</tr>
<tr class="even">
<td style="text-align: left; position: absolute;">{8E907F96-5A60-4B8C-97BD-D22B0B7DFBDE}</td>
<td style="text-align: center;">5</td>
</tr>
<tr class="odd">
<td style="text-align: left; position: absolute;">{A5E35727-E930-44CB-A734-10429FAAB9E1}</td>
<td style="text-align: center;">5</td>
</tr>
<tr class="even">
<td style="text-align: left; position: absolute;">{CDD7B77C-D1AC-43A8-B257-D1EEF6AC6689}</td>
<td style="text-align: center;">5</td>
</tr>
<tr class="odd">
<td style="text-align: left; position: absolute;">{F719CB95-F15C-4EED-8666-46D2030BA2CE}</td>
<td style="text-align: center;">5</td>
</tr>
<tr class="even">
<td style="text-align: left; position: absolute;">{0461EE2E-5C5A-4188-9821-F625C174D335}</td>
<td style="text-align: center;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left; position: absolute;">{0506B233-B0B9-4E64-B7BC-F61A7396923C}</td>
<td style="text-align: center;">4</td>
</tr>
<tr class="even">
<td style="text-align: left; position: absolute;">{112090DF-F669-41D9-BB11-381F86D64F6C}</td>
<td style="text-align: center;">4</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<p>In addition, we can check also if the record of the patient shown in Table @ref(tab:patient-multiple-records) has become the expected record in Table @ref(tab:patient-multiple-records-cleaned):</p>
<div class="cell">
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:100%; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<caption>Different records for the same infection(s) for patient with PseudoID</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Collection.Date</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Nationality</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Age</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Lineage</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Travel.History</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Tableau.ICU.Status</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Performing.Facility</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Sequenced</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; position: absolute;">2021-12-25</td>
<td style="text-align: left;">MOROCCO</td>
<td style="text-align: right;">30</td>
<td style="text-align: left;">BA.1</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Others</td>
<td style="text-align: left;">Danat Al Emarat Hospital</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left; position: absolute;">2022-06-09</td>
<td style="text-align: left;">MOROCCO</td>
<td style="text-align: right;">30</td>
<td style="text-align: left;">BA.5</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Others</td>
<td style="text-align: left;">G42 Laboratory</td>
<td style="text-align: left;">1</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<p>The distribution of lineages after the removal of duplicate records is shown in Figure @ref(fig:remove-duplicate-records-plot):</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/remove-duplicate-records-plot-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Number of people sequenced per variant after data cleaning. Only those variants that were sequenced with more than records per lineage are shown.</figcaption>
</figure>
</div>
</div>
</div>
<p>With the lineages unified and the duplicates removed, we can go ahead and study the data.</p>
</section>
</section>
<section id="comparison-between-sequenced-and-non-sequenced-samples" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="comparison-between-sequenced-and-non-sequenced-samples"><span class="header-section-number">1.3</span> Comparison between sequenced and non-sequenced samples</h2>
<p>One important aspect to compare population sequenced vs.&nbsp;non-sequenced is to see how the compare in terms of age. This will be shown the following subsections</p>
<section id="age-group-distribution-of-sequenced-and-non-sequenced-samples" class="level3" data-number="1.3.1">
<h3 data-number="1.3.1" class="anchored" data-anchor-id="age-group-distribution-of-sequenced-and-non-sequenced-samples"><span class="header-section-number">1.3.1</span> Age group distribution of sequenced and non-sequenced samples</h3>
<p>Once we have separated the sequenced with the non-sequenced data we can compare the distribution of cases for the not sequenced people. This will be compared with the sequenced data. This show in Figure @ref(fig:group-by-age-density):</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/group-by-age-density-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Density distribution of positive cases for sequenced and non-sequenced people</figcaption>
</figure>
</div>
</div>
</div>
<p>We can see also the total count for sequenced and non-sequenced groups in Figure @ref(fig:group-by-age-histogram):</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/group-by-age-histogram-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Histogram fo the distribution of positive cases for sequenced and non-sequenced people</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="samples-distributed-by-reason-for-sequencing" class="level3" data-number="1.3.2">
<h3 data-number="1.3.2" class="anchored" data-anchor-id="samples-distributed-by-reason-for-sequencing"><span class="header-section-number">1.3.2</span> Samples distributed by reason for sequencing</h3>
<p>We can break down the totals shown in Figure @ref(fig:distribution-by-reason-seq) into the age distribution by reason for sequencing:</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/distribution-by-reason-seq-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Density distribution of positive cases per reason of sequencing for sequenced and non-sequenced people</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="sample-distribution-based-on-nationality" class="level3" data-number="1.3.3">
<h3 data-number="1.3.3" class="anchored" data-anchor-id="sample-distribution-based-on-nationality"><span class="header-section-number">1.3.3</span> Sample distribution based on nationality</h3>
<p>We can see the distribution of the samples based on their nationality in Figure @ref(fig:distribution-by-nationality):</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="index_files/figure-html/distribution-by-nationality-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Due to the high number of labels however, it is difficult to define a significant difference for nationality regarding the samples for the sequenced and non-sequenced people.</p>
</section>
<section id="samples-for-comorbidities-of-sequenced-and-non-sequenced" class="level3" data-number="1.3.4">
<h3 data-number="1.3.4" class="anchored" data-anchor-id="samples-for-comorbidities-of-sequenced-and-non-sequenced"><span class="header-section-number">1.3.4</span> Samples for comorbidities of sequenced and non-sequenced</h3>
<p>Another aspect that could be studied was the distribution of the samples based on their risk factor. In this case, We can see the distribution of the samples based on their comorbidities in Figures @ref(fig:distribution-by-comorbidities-totals) and @ref(fig:distribution-by-comorbidities):</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="index_files/figure-html/distribution-by-comorbidities-totals-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="index_files/figure-html/distribution-by-comorbidities-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In Figure @ref(fig:distribution-by-comorbidities) we can see that the majority of the population had no comorbidities (&gt; 99%).</p>
</section>
<section id="samples-distributed-by-lab" class="level3" data-number="1.3.5">
<h3 data-number="1.3.5" class="anchored" data-anchor-id="samples-distributed-by-lab"><span class="header-section-number">1.3.5</span> Samples distributed by lab</h3>
<p>Another layer of granularity is the age distribution per lab. This could be helpful if we are trying to include only labs with an age distribution similar to the non-sequenced people. This is shown in Figure @ref(fig:samples-per-lab):</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/samples-per-lab-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Age distribution of samples collected by each lab.</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="distribution-of-samples-over-time" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="distribution-of-samples-over-time"><span class="header-section-number">1.4</span> Distribution of samples over time</h2>
<p>One more way to look at the data is to see how it is distributed over time, regardless of the age of the population. In particular, we can look at the distribution of cases per lineage sequenced, the hospitalisations and deaths</p>
<section id="number-of-cases-sequenced-by-lineage" class="level3" data-number="1.4.1">
<h3 data-number="1.4.1" class="anchored" data-anchor-id="number-of-cases-sequenced-by-lineage"><span class="header-section-number">1.4.1</span> Number of cases sequenced by lineage</h3>
<p>We can also plot the lineage evolution over time. We can do it per week for each variant count in Figure @ref(fig:lineage-over-time-N):</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/lineage-over-time-N-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Weekly total count of lineages sequenced. Only those lineages with 500 records or more in the entire dataset are shown.</figcaption>
</figure>
</div>
</div>
</div>
<p>Another way to visualize better which variant is taking over and when is to visualize this as a percentage. This is show in Figure @ref(fig:lineage-over-time-perc):</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/lineage-over-time-perc-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Weekly percentage of lineages sequenced. Only those lineages with 500 records or more in the entire dataset are shown.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="number-of-hospitalizations" class="level3" data-number="1.4.2">
<h3 data-number="1.4.2" class="anchored" data-anchor-id="number-of-hospitalizations"><span class="header-section-number">1.4.2</span> Number of hospitalizations</h3>
<p>One thing we can do is to summarise per month the number of people tested positive, hospitalized and deaths to compare with the sequenced data. The weekly hospitalisations are shown in Figure @ref(fig:biweekly-hospitalisations):</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/biweekly-hospitalisations-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Bi-weekly percentage of hospitalisation people per sequencing status.</figcaption>
</figure>
</div>
</div>
</div>
<p>As shown in Figure @ref(fig:biweekly-hospitalisations), it is clear that the proportion of people hospitalised from sequenced people is higher than those from people who are not sequenced. Therefore, a direct estimation from the sequenced data only will estimate a higher hospitalisation rate for each variant studied and therefore it is required to adjust for that bias.</p>
</section>
<section id="number-of-deaths" class="level3" data-number="1.4.3">
<h3 data-number="1.4.3" class="anchored" data-anchor-id="number-of-deaths"><span class="header-section-number">1.4.3</span> Number of deaths</h3>
<p>The number of deaths per sequencing status is shown in Figure @ref(fig:biweekly-deaths):</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/biweekly-deaths-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Bi-weekly percentage of deaths by sequenced status.</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="summary-table-of-totals" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="summary-table-of-totals"><span class="header-section-number">1.5</span> Summary table of totals</h2>
<p>A table summary for variants and reason for sequencing is shown in Table @ref(tab:table-by-variant):</p>
<div class="cell">
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:100%; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<caption>Number of cases, hospitalisations and death per lineage and reason for sequencing. NAs correspond to the values of not sequenced people.</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Reason for Sequencing</th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;">Lineage</th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;">Number of cases</th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;">Number of hospitalisations</th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;">Number of deaths</th>
<th data-quarto-table-cell-role="th" style="text-align: center; position: sticky; top: 0; background-color: #FFFFFF;">Number of ICUs</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; position: absolute;">Community Surveillance</td>
<td style="text-align: center;">B.1.1.3</td>
<td style="text-align: center;">104</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left; position: absolute;">Community Surveillance</td>
<td style="text-align: center;">B.1.1.7</td>
<td style="text-align: center;">1,357</td>
<td style="text-align: center;">66</td>
<td style="text-align: center;">13</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left; position: absolute;">Community Surveillance</td>
<td style="text-align: center;">B.1.351</td>
<td style="text-align: center;">3,785</td>
<td style="text-align: center;">181</td>
<td style="text-align: center;">25</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left; position: absolute;">Community Surveillance</td>
<td style="text-align: center;">B.1.525</td>
<td style="text-align: center;">936</td>
<td style="text-align: center;">27</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left; position: absolute;">Community Surveillance</td>
<td style="text-align: center;">B.1.617.1</td>
<td style="text-align: center;">472</td>
<td style="text-align: center;">31</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left; position: absolute;">Community Surveillance</td>
<td style="text-align: center;">B.1.617.2</td>
<td style="text-align: center;">88,407</td>
<td style="text-align: center;">4,945</td>
<td style="text-align: center;">309</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left; position: absolute;">Community Surveillance</td>
<td style="text-align: center;">BA.1</td>
<td style="text-align: center;">40,805</td>
<td style="text-align: center;">2,092</td>
<td style="text-align: center;">141</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left; position: absolute;">Community Surveillance</td>
<td style="text-align: center;">BA.2</td>
<td style="text-align: center;">30,186</td>
<td style="text-align: center;">1,488</td>
<td style="text-align: center;">63</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left; position: absolute;">Community Surveillance</td>
<td style="text-align: center;">BA.4</td>
<td style="text-align: center;">692</td>
<td style="text-align: center;">30</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left; position: absolute;">Community Surveillance</td>
<td style="text-align: center;">BA.5</td>
<td style="text-align: center;">15,939</td>
<td style="text-align: center;">873</td>
<td style="text-align: center;">23</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left; position: absolute;">Community Surveillance</td>
<td style="text-align: center;">BE.1</td>
<td style="text-align: center;">486</td>
<td style="text-align: center;">16</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left; position: absolute;">Community Surveillance</td>
<td style="text-align: center;">BM.1</td>
<td style="text-align: center;">203</td>
<td style="text-align: center;">13</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left; position: absolute;">Community Surveillance</td>
<td style="text-align: center;">BQ.1</td>
<td style="text-align: center;">313</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left; position: absolute;">Community Surveillance</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">875,608</td>
<td style="text-align: center;">28,354</td>
<td style="text-align: center;">967</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left; position: absolute;">ICU/HDU/Death</td>
<td style="text-align: center;">B.1.351</td>
<td style="text-align: center;">124</td>
<td style="text-align: center;">58</td>
<td style="text-align: center;">15</td>
<td style="text-align: center;">124</td>
</tr>
<tr class="even">
<td style="text-align: left; position: absolute;">ICU/HDU/Death</td>
<td style="text-align: center;">B.1.617.2</td>
<td style="text-align: center;">492</td>
<td style="text-align: center;">247</td>
<td style="text-align: center;">87</td>
<td style="text-align: center;">492</td>
</tr>
<tr class="odd">
<td style="text-align: left; position: absolute;">ICU/HDU/Death</td>
<td style="text-align: center;">BA.5</td>
<td style="text-align: center;">121</td>
<td style="text-align: center;">77</td>
<td style="text-align: center;">11</td>
<td style="text-align: center;">121</td>
</tr>
<tr class="even">
<td style="text-align: left; position: absolute;">Travel</td>
<td style="text-align: center;">B.1.617.2</td>
<td style="text-align: center;">1,389</td>
<td style="text-align: center;">279</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left; position: absolute;">Travel</td>
<td style="text-align: center;">BA.1</td>
<td style="text-align: center;">4,891</td>
<td style="text-align: center;">200</td>
<td style="text-align: center;">12</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left; position: absolute;">Travel</td>
<td style="text-align: center;">BA.2</td>
<td style="text-align: center;">4,637</td>
<td style="text-align: center;">235</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left; position: absolute;">Travel</td>
<td style="text-align: center;">BA.4</td>
<td style="text-align: center;">194</td>
<td style="text-align: center;">10</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left; position: absolute;">Travel</td>
<td style="text-align: center;">BA.5</td>
<td style="text-align: center;">3,630</td>
<td style="text-align: center;">171</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left; position: absolute;">Travel</td>
<td style="text-align: center;">BE.1</td>
<td style="text-align: center;">120</td>
<td style="text-align: center;">7</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left; position: absolute;">Travel</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">101,211</td>
<td style="text-align: center;">3,613</td>
<td style="text-align: center;">49</td>
<td style="text-align: center;">NA</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<p>From summary Table @ref(tab:table-by-variant) a weighted average of the hospitalisation and death rate for each variant can be obtained and then compared it to the non-sequenced data. Given that the number of records of the community surveillance is substantially much higher than the rest of the groups, it could be advisable to use only community surveillance data only.</p>
<p>It can be seen that some of the records labeled as ICU did not match their hospitalisation flag. Therefore this needs to be corrected in the raw data as well.</p>
</section>
<section id="time-evolution-of-daily-cases-curve" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="time-evolution-of-daily-cases-curve"><span class="header-section-number">1.6</span> Time evolution of daily cases curve</h2>
<p>A final check that we are looking at similar data sources can be a comparison between the totals reported during the pandemic and the cases recorded after cleaning the data in this study. This is show in Figure @ref(fig:comparison-with-estijaba):</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/comparison-with-estijaba-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Number of cases over time for two different data sources, namely this study and totals reported by Estijaba.</figcaption>
</figure>
</div>
</div>
</div>
<p>Since the number of sequenced for the delta variant appears to be somehow very large, we can plot the number of cases per variant over time. This is shown in Figure @ref(fig:comparison-with-estijaba-lineages):</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/comparison-with-estijaba-lineages-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Number of cases over time for two different data sources, namely this study and totals reported by Estijaba.</figcaption>
</figure>
</div>
</div>
</div>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb2" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> Data analysis to evaluate the hospitalisation risk between SARS-CoV-2 Variants</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Mauricio Patón"</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2023-01-12"</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> [code, analysis, covid19]</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> "image.jpg"</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="an">toc:</span><span class="co"> true</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="an">number-sections:</span><span class="co"> true</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># execute:</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   cache: true</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> F, <span class="at">tidy =</span> <span class="cn">TRUE</span>, <span class="at">message =</span> <span class="cn">FALSE</span>, <span class="at">warning =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Deactivate the message in summarising from dplyr</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">dplyr.summarise.inform =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>plots_font_size <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>engine <span class="ot">=</span> <span class="st">'tikz'</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>engine.opts <span class="ot">=</span> <span class="fu">list</span>( <span class="at">convert =</span> <span class="st">'convert'</span>, <span class="at">convert.opts =</span> <span class="st">'-density 300'</span>)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>fig.ext <span class="ot">=</span> <span class="st">'png'</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>knit_engines<span class="sc">$</span><span class="fu">set</span>(<span class="st">'javascript'</span>)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introduction</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>In this report, an analysis of the data to be used to estimate epidemiological parameters for the different SARS-CoV-2 lineages of interest (e.g.: BA.1, B.1.629, etc.) is presented. Firstly, the data is cleaned to ensure that no duplicates, and proper lineages are used. Then, the data analysis is conducted. In particular, the analysis is focused on the identification of potential biases in the data as it compares people who were sequenced against people who were not sequenced.</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>:::{.callout-warning}</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>Due to confidentiality issues, the results have been masked in this document accordingly.</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>The data displayed in the figures, tables and text are shown for illustrative purposes and do not reflect real numbers.</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="fu">## Sampling Issues</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>The <span class="co">[</span><span class="ot">sampling strategy followed in the United Arab Emirates</span><span class="co">]()</span> from <span class="kw">&lt;u&gt;</span>**January 1st, 2022**<span class="kw">&lt;/u&gt;</span> comprised the sequencing of samples from individuals that belonged to one of the following groups:</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>All people in ICU/HDU and/or deceased.</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>All people who entered through a port of entry and had a positive PCR.</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>The rest of the infected people were sequenced based on a random sample proportionally to the number of positives reported by each lab on a weekly basis.</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>Sampling prior to the stated day needs to be double-checked for proper interpretation.</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>The sampling strategy described follows WHO recommendation. Therefore, it might be of interest to develop a methodology in which an unbiased (or systematically low bias) estimator of the sample is found after following WHO recommendations for sampling COVID-19 patients.</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load-libraries}</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(tidyverse)) <span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>, <span class="at">repos =</span> <span class="st">"http://cran.us.r-project.org"</span>)</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(ggplot2)) <span class="fu">install.packages</span>(<span class="st">"ggplot2"</span>, <span class="at">repos =</span> <span class="st">"http://cran.us.r-project.org"</span>)</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(lubridate)) <span class="fu">install.packages</span>(<span class="st">"lubridate"</span>, <span class="at">repos =</span> <span class="st">"http://cran.us.r-project.org"</span>)</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(janitor)) <span class="fu">install.packages</span>(<span class="st">"janitor"</span>, <span class="at">repos =</span> <span class="st">"http://cran.us.r-project.org"</span>)</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(stringr)) <span class="fu">install.packages</span>(<span class="st">"stringr"</span>, <span class="at">repos =</span> <span class="st">"http://cran.us.r-project.org"</span>)</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(kableExtra)) <span class="fu">install.packages</span>(<span class="st">"kableExtra"</span>, <span class="at">repos =</span> <span class="st">"http://cran.us.r-project.org"</span>)</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(openxlsx)) <span class="fu">install.packages</span>(<span class="st">"openxlsx"</span>, <span class="at">repos =</span> <span class="st">"http://cran.us.r-project.org"</span>)</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(scales)) <span class="fu">install.packages</span>(<span class="st">"scales"</span>, <span class="at">repos =</span> <span class="st">"http://cran.us.r-project.org"</span>)</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(ggthemes)) <span class="fu">install.packages</span>(<span class="st">"ggthemes"</span>, <span class="at">repos =</span> <span class="st">"http://cran.us.r-project.org"</span>)</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(bookdown)) <span class="fu">install.packages</span>(<span class="st">"bookdown"</span>, <span class="at">repos =</span> <span class="st">"http://cran.us.r-project.org"</span>)</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(plotly)) <span class="fu">install.packages</span>(<span class="st">"plotly"</span>, <span class="at">repos =</span> <span class="st">"http://cran.us.r-project.org"</span>)</span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(data.table)) <span class="fu">install.packages</span>(<span class="st">"data.table"</span>, <span class="at">repos =</span> <span class="st">"http://cran.us.r-project.org"</span>)</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bookdown)</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>First, we are going to load the dataset and examine it:</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load-raw-data, echo = F}</span></span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a><span class="co"># Load original data and missing ID data</span></span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>omicron.data <span class="ot">&lt;-</span> <span class="fu">read.delim2</span>(<span class="st">"./data-provided/20230110-Lineage_Subvariant-Study.txt"</span>, <span class="at">sep =</span> <span class="st">","</span>, <span class="at">header =</span> T)</span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>missing.age.IDs <span class="ot">&lt;-</span> openxlsx<span class="sc">::</span><span class="fu">read.xlsx</span>(<span class="st">"./data-provided/20230117-Lineage-of-missing-age-pseduoids.xlsx"</span>)</span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a><span class="co"># # Fill missing ID</span></span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(missing.age.IDs)[<span class="dv">2</span>] <span class="ot">=</span> <span class="st">"AGE"</span></span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>missing.age.IDs <span class="ot">&lt;-</span> missing.age.IDs <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">PseudoID =</span> <span class="fu">paste0</span>(<span class="st">"{"</span>,PseudoID,<span class="st">"}"</span>))</span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a><span class="co"># Check variables from original data</span></span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(omicron.data)</span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>As we see, we have information per patient for the following variables:</span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`PseudoID`</span>: Unique identifier for each patient.</span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Lineage`</span>: Identification of the lineage sequenced.</span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`CollectionDateTime`</span>: Date and time in which the PCR sample was collected for the infected patient.</span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Dose_VaccinationDate`</span>: Date in which the vaccination of the dose referred was taken.</span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Dose_Vaccine_Type`</span>: Type of vaccine that was taken.</span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Vaccination Status`</span>: Fully vaccinated if the individual got at least two doses or unvaccinated.</span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`NoOfDoses`</span>: Number of vaccine doses received per individual.</span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`LineageHospitalized`</span>: Identification of hospitalization for the patient who was sequenced.</span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`IsDied`</span>: Identification of death for the patient.</span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Death_Date`</span>: Date in which the patient died.</span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`LOS`</span>: Length of stay in the hospital.</span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Hospital_Discharge_date`</span>: Date in which the patient was discharged.</span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Date_hospitalization`</span>: Date in which the patient was admitted.</span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Gender`</span>: Male or Female.</span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Nationality`</span>: Expatriate or Local.</span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Covid_Variant`</span>: Recoding of the variant of the COVID Lineage.</span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Comorbidities`</span>: Number of comorbidities per patient.</span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`PriorInfection`</span>: Flag if the patient registered a prior infection before the current positive.</span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`PriorInfection_Count`</span>: Number of previous infections registered.</span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Age`</span>: Age of the patient.</span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Band15Years`</span>: Age group of 15 years old for the patient.</span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Sequenced`</span>: Identification for patients that were sequenced or not sequenced.</span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Performing.Facility`</span>: Lab conducting the collection of the sample that was sequencing. *This field will be used to estimate the population properties of those that were randomly sequenced. In particular, checking the randomness assumption is a goal of the work presented in this document. (Group 3)*</span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Tableau_ICU_Status`</span>: Label if the patient is ICU/HDU or dead. *This field will be used to label the patients as HDU/ICU pr dead as reason per sequencing. All patients labeled in this field were sequenced. (Group 1)*</span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Tableau_Travel_Country_Name`</span>: Travel history of the positive patient in the last XX days. *This field will be used to label those patients who tested positive and had a travel history according to the IDN and PRP databases. (Group 2)*</span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a><span class="fu">## Cleaning data procedure</span></span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>Firstly, we need to clean the data to ensure that the data is of a good enough quality and no double-counting occurs. In particular we are going to focus on three aspects:</span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Re-code lineage into relevant variants. In particular:</span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>    a<span class="sc">\.</span> Rename AY.XX into parent lineage Delta B.1.659.2.</span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>    b<span class="sc">\.</span> Rename all BA.X.X into the parent lineage BA.X (e.g. BA.1.1 is renamed as BA.1).</span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>    c<span class="sc">\.</span> Rename variant B.1.1.529 as BA.1 as per this <span class="co">[</span><span class="ot">description</span><span class="co">](https://gvn.org/omicron-b-1-1-529/)</span>.</span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Fix records in which age is not defined by retrieving the age from the year of birth from the Emirates ID.</span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a><span class="in">```{r invalid-records}</span></span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>nWrongEIDs <span class="ot">&lt;-</span> omicron.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">startsWith</span>(PseudoID, <span class="st">"{"</span>)) <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()</span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a>nWrongLineage <span class="ot">&lt;-</span> omicron.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Lineage <span class="sc">==</span> <span class="st">"Jul 25 2022 12:00AM"</span>) <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()</span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a>nWrongDates <span class="ot">&lt;-</span> omicron.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(CollectionDateTime <span class="sc">&lt;=</span> <span class="st">"2020-02-01"</span>, CollectionDateTime <span class="sc">!=</span> <span class="st">""</span>) <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()</span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a>min_n_variant <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Remove invalid records, namely:</span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>    a<span class="sc">\.</span> EIDs that are invalid and do not correspond to any record (<span class="in">`r nWrongEIDs`</span> records).</span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a>    b<span class="sc">\.</span> Records with lineage labeled as <span class="in">`Jul 25 2022 12:00AM`</span> (<span class="in">`r nWrongLineage`</span> records).</span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a>    c.\ Records with a <span class="in">`CollectionDateTime`</span> before February 1st, 2020 (<span class="in">`r nWrongDates`</span> records).</span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>Remove duplicate IDs covering the same infection case are present in the database (e.g. two EIDs for the same date labeled the lineage as BA.2 and BA.2.1).</span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>Select for the patients sequenced only those whose lineage sequenced have at least more than **`r min_n_variant` records**.</span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a><span class="ss">6.  </span>Check also how many records labeled as non-sequenced have a lab assigned according to the dashboard data from ADPHC.</span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a>Once the data is cleaned, we can summarize the number of cases per variant recorded and compare it to the values published by ADPHC.</span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a><span class="fu">### Summary of main lineages after re-labeling</span></span>
<span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a>Lineages in the dataset appear with multiple names. Some of those lineages were recorded with multiple names. In the original dataset there are 1000 different variants labeled. Some of the reasons for so many sublineages defined registered were </span>
<span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>All sublineages were registered (e.g.: BA.2.40, BA.2.75)</span>
<span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The mutation of the sublineage was labeled registered (e.g.: AY.17 (S:D1118Y))  </span>
<span id="cb2-164"><a href="#cb2-164" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Some sublineages contain a certain description (e.g. BA.2 (Recombinant?))</span>
<span id="cb2-165"><a href="#cb2-165" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Some sublineages are double coded (e.g.: "Delta/B.1.617.2")</span>
<span id="cb2-166"><a href="#cb2-166" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Some sublineages were wrongly labeled (e.g.: ~2000 records with "Jul 25 2022 12:00AM" as lineage)</span>
<span id="cb2-167"><a href="#cb2-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-168"><a href="#cb2-168" aria-hidden="true" tabindex="-1"></a>Therefore, an aggregation criteria needs to be defined. For the purposes of this report, the following criteria was used:</span>
<span id="cb2-169"><a href="#cb2-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-170"><a href="#cb2-170" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Description of mutations were removed (e.g. AY.17 (S:D1118Y) becomes AY.17)</span>
<span id="cb2-171"><a href="#cb2-171" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>All variants were re-defined to their main sub-lineages (e.g.: AY.17 or AY.103 were redefined as B.1.617.2).</span>
<span id="cb2-172"><a href="#cb2-172" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Double labeling was defined as per the lineage name (e.g.:Delta/B.1.617.2 was coded as B.1.617.2).</span>
<span id="cb2-173"><a href="#cb2-173" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Variant B.1.1.529 was renamed as BA.1.</span>
<span id="cb2-174"><a href="#cb2-174" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>All records with lineage labeled as "Jul 25 2022 12:00AM" were removed.</span>
<span id="cb2-175"><a href="#cb2-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-176"><a href="#cb2-176" aria-hidden="true" tabindex="-1"></a>After the re-coding of the lineages in the databases, the number of records for each lineage (for those lineages that contained more than <span class="in">`r min_n_variant`</span> records) is shown in Figure \@ref(fig:check-recoded-lineages). It is important to note that this distribution is done with the raw data before removing duplicates in the data.</span>
<span id="cb2-177"><a href="#cb2-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-178"><a href="#cb2-178" aria-hidden="true" tabindex="-1"></a><span class="in">```{r recode-lineages, fig.cap = "Number of records per lineage before removal of duplicates."}</span></span>
<span id="cb2-179"><a href="#cb2-179" aria-hidden="true" tabindex="-1"></a>data.lineages <span class="ot">&lt;-</span> omicron.data <span class="sc">%&gt;%</span>  </span>
<span id="cb2-180"><a href="#cb2-180" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Recode variant names</span></span>
<span id="cb2-181"><a href="#cb2-181" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">Lineage.Short =</span> <span class="fu">sub</span>(<span class="st">'([A-Z]{1,2}[.]?[0-9]{1,3}[.]?[0-9]{0,3}[.]?[0-9]{0,1}).*'</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, Lineage)) <span class="sc">%&gt;%</span></span>
<span id="cb2-182"><a href="#cb2-182" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">Lineage.Short =</span> <span class="fu">sub</span>(<span class="st">'([A-Z]{2}.[0-9]{1}).*'</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, Lineage.Short))  <span class="sc">%&gt;%</span></span>
<span id="cb2-183"><a href="#cb2-183" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">Lineage.Short =</span> <span class="fu">str_replace</span>(Lineage.Short, <span class="st">"B.1.1.5"</span>, <span class="st">"B.1.1.529"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-184"><a href="#cb2-184" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">Lineage.Short =</span> <span class="fu">str_replace</span>(Lineage.Short, <span class="st">"B.1.1.529"</span>, <span class="st">"BA.1"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-185"><a href="#cb2-185" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">Lineage.Short =</span> <span class="fu">if_else</span>(<span class="fu">startsWith</span>(Lineage.Short, <span class="st">"AY"</span>), <span class="st">"B.1.617.2"</span>, Lineage.Short)) <span class="sc">%&gt;%</span></span>
<span id="cb2-186"><a href="#cb2-186" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">Lineage.Short =</span> <span class="fu">if_else</span>(<span class="fu">str_detect</span>(Lineage.Short, <span class="st">"B.1.617.2"</span>), <span class="st">"B.1.617.2"</span>, Lineage.Short)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-187"><a href="#cb2-187" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Fill missing age values</span></span>
<span id="cb2-188"><a href="#cb2-188" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">AGE =</span> <span class="fu">as.numeric</span>(AGE)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-189"><a href="#cb2-189" aria-hidden="true" tabindex="-1"></a>          <span class="fu">left_join</span>(missing.age.IDs, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"PseudoID"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-190"><a href="#cb2-190" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">Age =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(AGE.x), AGE.y, AGE.x)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-191"><a href="#cb2-191" aria-hidden="true" tabindex="-1"></a>          <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(AGE.x, AGE.y)) <span class="sc">%&gt;%</span></span>
<span id="cb2-192"><a href="#cb2-192" aria-hidden="true" tabindex="-1"></a>          <span class="fu">filter</span>(Age <span class="sc">&gt;=</span> <span class="dv">0</span>, Age <span class="sc">&lt;=</span> <span class="dv">150</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-193"><a href="#cb2-193" aria-hidden="true" tabindex="-1"></a>          <span class="fu">filter</span>(Lineage.Short <span class="sc">!=</span> <span class="st">"Jul 25 2022 12:00AM"</span>, </span>
<span id="cb2-194"><a href="#cb2-194" aria-hidden="true" tabindex="-1"></a>                 CollectionDateTime <span class="sc">&gt;=</span> <span class="st">"2020-02-01"</span>,</span>
<span id="cb2-195"><a href="#cb2-195" aria-hidden="true" tabindex="-1"></a>                 CollectionDateTime <span class="sc">&lt;=</span> <span class="st">"2022-09-30"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-196"><a href="#cb2-196" aria-hidden="true" tabindex="-1"></a>          <span class="fu">filter</span>(<span class="fu">startsWith</span>(PseudoID, <span class="st">"{"</span>))</span>
<span id="cb2-197"><a href="#cb2-197" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-198"><a href="#cb2-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-199"><a href="#cb2-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-200"><a href="#cb2-200" aria-hidden="true" tabindex="-1"></a><span class="in">```{r check-recoded-lineages, fig.cap = "Number of records per lineage before removal of duplicates."}</span></span>
<span id="cb2-201"><a href="#cb2-201" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot lineages distribution with duplicate data</span></span>
<span id="cb2-202"><a href="#cb2-202" aria-hidden="true" tabindex="-1"></a>data.lineages <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Sequenced <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-203"><a href="#cb2-203" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Lineage.Short) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb2-204"><a href="#cb2-204" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> min_n_variant) <span class="sc">%&gt;%</span></span>
<span id="cb2-205"><a href="#cb2-205" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n =</span> <span class="fu">log</span>(n, <span class="at">base =</span> <span class="dv">42</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-206"><a href="#cb2-206" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Lineage.Short, <span class="at">y =</span> n, <span class="at">fill =</span> Lineage.Short)) <span class="sc">+</span></span>
<span id="cb2-207"><a href="#cb2-207" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_col(aes(fill = Lineage.Short)) + </span></span>
<span id="cb2-208"><a href="#cb2-208" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>,  <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb2-209"><a href="#cb2-209" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span><span class="fu">round</span>(n,<span class="dv">1</span>)), <span class="at">position=</span><span class="fu">position_dodge</span>(<span class="at">width=</span><span class="fl">0.9</span>), <span class="at">vjust=</span><span class="sc">-</span><span class="fl">0.25</span>, <span class="at">size=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb2-210"><a href="#cb2-210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> comma) <span class="sc">+</span></span>
<span id="cb2-211"><a href="#cb2-211" aria-hidden="true" tabindex="-1"></a>          <span class="fu">xlab</span>(<span class="st">"Lineage sequenced"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"# people"</span>) <span class="sc">+</span></span>
<span id="cb2-212"><a href="#cb2-212" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Number of sequenced records before removing duplicate IDs"</span>)</span>
<span id="cb2-213"><a href="#cb2-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-214"><a href="#cb2-214" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-215"><a href="#cb2-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-216"><a href="#cb2-216" aria-hidden="true" tabindex="-1"></a>Once lineages have been re-coded and the data cleaned from invalid records, we can move into the removal of duplicates.</span>
<span id="cb2-217"><a href="#cb2-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-218"><a href="#cb2-218" aria-hidden="true" tabindex="-1"></a><span class="fu">### Clean Duplicate EIDs</span></span>
<span id="cb2-219"><a href="#cb2-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-220"><a href="#cb2-220" aria-hidden="true" tabindex="-1"></a>After recoding lineages and fixing the records that were considered as invalid, the next step consists of cleaning the data by removing all the duplicates.</span>
<span id="cb2-221"><a href="#cb2-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-222"><a href="#cb2-222" aria-hidden="true" tabindex="-1"></a>Firstly, We check the number of duplicate IDs appearing in the database. This is shown in  <span class="co">[</span><span class="ot">@tbl-duplicate-ids-check</span><span class="co">]</span> or Table \@ref(tab:duplicate-ids-check):</span>
<span id="cb2-223"><a href="#cb2-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-224"><a href="#cb2-224" aria-hidden="true" tabindex="-1"></a><span class="in">```{r duplicate-ids-check}</span></span>
<span id="cb2-225"><a href="#cb2-225" aria-hidden="true" tabindex="-1"></a>patient.multiple.records <span class="ot">&lt;-</span> data.lineages <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Sequenced <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(PseudoID) <span class="sc">%&gt;%</span> </span>
<span id="cb2-226"><a href="#cb2-226" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">summarise</span>(<span class="at">Count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb2-227"><a href="#cb2-227" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">filter</span>(Count<span class="sc">&gt;</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-228"><a href="#cb2-228" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">arrange</span>(<span class="fu">desc</span>(Count)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-229"><a href="#cb2-229" aria-hidden="true" tabindex="-1"></a>                                              <span class="co"># slice(1:5, 30:35, (n()-5):n())</span></span>
<span id="cb2-230"><a href="#cb2-230" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb2-231"><a href="#cb2-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-232"><a href="#cb2-232" aria-hidden="true" tabindex="-1"></a>patient.multiple.records <span class="sc">%&gt;%</span></span>
<span id="cb2-233"><a href="#cb2-233" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">booktabs =</span> T, <span class="at">escape =</span> F, <span class="at">format.args =</span> <span class="fu">list</span>(<span class="at">big.mark =</span> <span class="st">","</span>),</span>
<span id="cb2-234"><a href="#cb2-234" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"Number of records per ID number of the 10 most repeated records in the database."</span>),</span>
<span id="cb2-235"><a href="#cb2-235" aria-hidden="true" tabindex="-1"></a>                                  <span class="co"># digits = c(0, rep(c(rep(0,3),rep(3,3)), length(labelsW))), </span></span>
<span id="cb2-236"><a href="#cb2-236" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"PseudoID"</span>, <span class="st">"# records"</span>),</span>
<span id="cb2-237"><a href="#cb2-237" aria-hidden="true" tabindex="-1"></a>                                  <span class="co"># width = 12,</span></span>
<span id="cb2-238"><a href="#cb2-238" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">align =</span> <span class="fu">c</span>(<span class="st">'l'</span>,<span class="st">'c'</span>))  <span class="sc">%&gt;%</span></span>
<span id="cb2-239"><a href="#cb2-239" aria-hidden="true" tabindex="-1"></a>                                  <span class="co"># row_spec(0, bold=TRUE)</span></span>
<span id="cb2-240"><a href="#cb2-240" aria-hidden="true" tabindex="-1"></a>                           kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="fu">c</span>(<span class="st">"striped"</span>,<span class="st">"hover"</span>), <span class="at">full_width =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb2-241"><a href="#cb2-241" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">column_spec</span>(<span class="at">column =</span> <span class="dv">1</span>, <span class="at">extra_css =</span> <span class="st">"position: absolute"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-242"><a href="#cb2-242" aria-hidden="true" tabindex="-1"></a>                           <span class="co"># column_spec(column = 1:length(colnames_allTable), width = "12em; min-width: 8em;") %&gt;%</span></span>
<span id="cb2-243"><a href="#cb2-243" aria-hidden="true" tabindex="-1"></a>                           kableExtra<span class="sc">::</span><span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"100%"</span>, <span class="at">fixed_thead =</span> T)</span>
<span id="cb2-244"><a href="#cb2-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-245"><a href="#cb2-245" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-246"><a href="#cb2-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-247"><a href="#cb2-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-248"><a href="#cb2-248" aria-hidden="true" tabindex="-1"></a>As we see in the summary table, there are many patients that are repeated in the records (as many as 340 times). </span>
<span id="cb2-249"><a href="#cb2-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-250"><a href="#cb2-250" aria-hidden="true" tabindex="-1"></a>For example, we can see the different labels for a given patient in Table \@ref(tab:patient-multiple-records):</span>
<span id="cb2-251"><a href="#cb2-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-252"><a href="#cb2-252" aria-hidden="true" tabindex="-1"></a><span class="in">```{r patient-multiple-records}</span></span>
<span id="cb2-253"><a href="#cb2-253" aria-hidden="true" tabindex="-1"></a>patientID <span class="ot">&lt;-</span> <span class="st">"{6BFEAEC8-A945-48B5-B87B-59E8E6F64435}"</span></span>
<span id="cb2-254"><a href="#cb2-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-255"><a href="#cb2-255" aria-hidden="true" tabindex="-1"></a>data.lineages <span class="sc">%&gt;%</span> <span class="fu">filter</span>(PseudoID <span class="sc">%in%</span> patientID) <span class="sc">%&gt;%</span> </span>
<span id="cb2-256"><a href="#cb2-256" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CollectionDateTime, Nationality, Age, Lineage.Short, Tableau_Travel_Country_Name, Tableau_ICU_Status, Performing.Facility, Sequenced) <span class="sc">%&gt;%</span> </span>
<span id="cb2-257"><a href="#cb2-257" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">30</span><span class="sc">:</span><span class="dv">35</span>, (<span class="fu">n</span>()<span class="sc">-</span><span class="dv">5</span>)<span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb2-258"><a href="#cb2-258" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">booktabs =</span> T, <span class="at">escape =</span> F, <span class="at">format.args =</span> <span class="fu">list</span>(<span class="at">big.mark =</span> <span class="st">","</span>),</span>
<span id="cb2-259"><a href="#cb2-259" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"Different records for the same infection(s) for patient with PseudoID"</span>, patientID)) <span class="sc">%&gt;%</span></span>
<span id="cb2-260"><a href="#cb2-260" aria-hidden="true" tabindex="-1"></a>                                  <span class="co"># digits = c(0, rep(c(rep(0,3),rep(3,3)), length(labelsW))), </span></span>
<span id="cb2-261"><a href="#cb2-261" aria-hidden="true" tabindex="-1"></a>                                  <span class="co"># col.names = c("PseudoID", "# records"),</span></span>
<span id="cb2-262"><a href="#cb2-262" aria-hidden="true" tabindex="-1"></a>                                  <span class="co"># width = 12,</span></span>
<span id="cb2-263"><a href="#cb2-263" aria-hidden="true" tabindex="-1"></a>                                  <span class="co"># align = c('l','c'))  %&gt;%</span></span>
<span id="cb2-264"><a href="#cb2-264" aria-hidden="true" tabindex="-1"></a>                                  <span class="co"># row_spec(0, bold=TRUE)</span></span>
<span id="cb2-265"><a href="#cb2-265" aria-hidden="true" tabindex="-1"></a>                           kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="fu">c</span>(<span class="st">"striped"</span>,<span class="st">"hover"</span>), <span class="at">full_width =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb2-266"><a href="#cb2-266" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">column_spec</span>(<span class="at">column =</span> <span class="dv">1</span>, <span class="at">extra_css =</span> <span class="st">"position: absolute"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-267"><a href="#cb2-267" aria-hidden="true" tabindex="-1"></a>                           <span class="co"># column_spec(column = 1:length(colnames_allTable), width = "12em; min-width: 8em;") %&gt;%</span></span>
<span id="cb2-268"><a href="#cb2-268" aria-hidden="true" tabindex="-1"></a>                           kableExtra<span class="sc">::</span><span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"100%"</span>, <span class="at">fixed_thead =</span> T)  </span>
<span id="cb2-269"><a href="#cb2-269" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-270"><a href="#cb2-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-271"><a href="#cb2-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-272"><a href="#cb2-272" aria-hidden="true" tabindex="-1"></a>Therefore it looks like many patients are registered as repeated cases for the same infection episode. Those patients had differences in the label in the following fields:</span>
<span id="cb2-273"><a href="#cb2-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-274"><a href="#cb2-274" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Variant names (e.g. BA.1 and BA.1.1 for the same patient - not shown in table after recoding. </span>
<span id="cb2-275"><a href="#cb2-275" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Collection dates (e.g. patient collection date was 7/2/2021 and 8/2/2021).</span>
<span id="cb2-276"><a href="#cb2-276" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Different values for <span class="in">`Tableau_Country_Names`</span> (e.g. Yes/No/Country name).</span>
<span id="cb2-277"><a href="#cb2-277" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Infection episodes (e.g. one infection in 30/07/2021 and 01/02/2022).</span>
<span id="cb2-278"><a href="#cb2-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-279"><a href="#cb2-279" aria-hidden="true" tabindex="-1"></a>Therefore, we need an additional aggregation step to identify each infection episode as a unique record. The following steps were followed to fix this issue with duplicate EIDs: </span>
<span id="cb2-280"><a href="#cb2-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-281"><a href="#cb2-281" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Identify each episode of infection within **30 days** as one infection episode.</span>
<span id="cb2-282"><a href="#cb2-282" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Define Collection Date as the first date in which the sample of the infected individual was collected</span>
<span id="cb2-283"><a href="#cb2-283" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Fill the nationality field with the record that contains a nationality </span>
<span id="cb2-284"><a href="#cb2-284" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Fill the lineage field with the first record of the patient that contains a proper lineage</span>
<span id="cb2-285"><a href="#cb2-285" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>Create a <span class="in">`Travel.Country`</span> field in which to register the country name (if available) for the given ID.</span>
<span id="cb2-286"><a href="#cb2-286" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>Create a <span class="in">`Travel.History`</span> field in which to register the labels Yes/No/Unknown for the given ID.</span>
<span id="cb2-287"><a href="#cb2-287" aria-hidden="true" tabindex="-1"></a><span class="ss">7. </span>Create a  <span class="in">`Traveled`</span> field with Yes/No if there is a valid field in Travel.Country or Travel.History (e.g. patient with empty field in Travel.History but with Travel.Country label). This means that those patients with travel history unknown and/or travel country name as unknown were considered as non-travelers.</span>
<span id="cb2-288"><a href="#cb2-288" aria-hidden="true" tabindex="-1"></a><span class="ss">8. </span>Register the first non-empty field for Tableau_ICU_Status.</span>
<span id="cb2-289"><a href="#cb2-289" aria-hidden="true" tabindex="-1"></a><span class="ss">9. </span>Register the first non-empty field for Performing Facility for sequenced patients (when available).</span>
<span id="cb2-290"><a href="#cb2-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-291"><a href="#cb2-291" aria-hidden="true" tabindex="-1"></a><span class="in">```{r remove-duplicate-records-dplyr}</span></span>
<span id="cb2-292"><a href="#cb2-292" aria-hidden="true" tabindex="-1"></a>use_dplyr <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb2-293"><a href="#cb2-293" aria-hidden="true" tabindex="-1"></a><span class="co"># Variables required</span></span>
<span id="cb2-294"><a href="#cb2-294" aria-hidden="true" tabindex="-1"></a>threshold_days <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb2-295"><a href="#cb2-295" aria-hidden="true" tabindex="-1"></a>travel_history <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Yes"</span>, <span class="st">"No"</span>, <span class="st">"Unknown"</span>)</span>
<span id="cb2-296"><a href="#cb2-296" aria-hidden="true" tabindex="-1"></a>countries <span class="ot">&lt;-</span> data.lineages <span class="sc">%&gt;%</span> <span class="fu">select</span>(Tableau_Travel_Country_Name) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>Tableau_Travel_Country_Name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"UNKNOWN"</span>, <span class="st">"Unknown"</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>, <span class="st">""</span>)) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">pull</span>()</span>
<span id="cb2-297"><a href="#cb2-297" aria-hidden="true" tabindex="-1"></a>nationalities <span class="ot">&lt;-</span> data.lineages <span class="sc">%&gt;%</span> <span class="fu">select</span>(Nationality) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Nationality <span class="sc">!=</span> <span class="st">"Expatraite"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>()</span>
<span id="cb2-298"><a href="#cb2-298" aria-hidden="true" tabindex="-1"></a>tableau_ICU_Status <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"HDU"</span>, <span class="st">"ICU"</span>, <span class="st">"Others"</span>)</span>
<span id="cb2-299"><a href="#cb2-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-300"><a href="#cb2-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-301"><a href="#cb2-301" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (use_dplyr){</span>
<span id="cb2-302"><a href="#cb2-302" aria-hidden="true" tabindex="-1"></a>data.lineages.cleaned.dplyr <span class="ot">&lt;-</span> data.lineages <span class="sc">%&gt;%</span></span>
<span id="cb2-303"><a href="#cb2-303" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(Sequenced == 1) %&gt;%</span></span>
<span id="cb2-304"><a href="#cb2-304" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-305"><a href="#cb2-305" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CollectionDateTime =</span> <span class="fu">as.Date</span>(CollectionDateTime))<span class="sc">%&gt;%</span> </span>
<span id="cb2-306"><a href="#cb2-306" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(CollectionDateTime) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(PseudoID) <span class="sc">%&gt;%</span> </span>
<span id="cb2-307"><a href="#cb2-307" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">timeDiff =</span> CollectionDateTime <span class="sc">-</span> <span class="fu">lag</span>(CollectionDateTime),</span>
<span id="cb2-308"><a href="#cb2-308" aria-hidden="true" tabindex="-1"></a>         <span class="at">timeDiff.Days =</span> <span class="fu">as.numeric</span>(timeDiff, <span class="at">units =</span> <span class="st">'days'</span>),</span>
<span id="cb2-309"><a href="#cb2-309" aria-hidden="true" tabindex="-1"></a>         <span class="at">timeDiff.Days =</span> <span class="fu">coalesce</span>(timeDiff.Days, <span class="dv">0</span>),</span>
<span id="cb2-310"><a href="#cb2-310" aria-hidden="true" tabindex="-1"></a>         <span class="at">groupID =</span> <span class="fu">ifelse</span>(timeDiff.Days <span class="sc">&gt;</span> threshold_days, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb2-311"><a href="#cb2-311" aria-hidden="true" tabindex="-1"></a>         <span class="at">Infection.Count =</span> <span class="fu">cumsum</span>(groupID) <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb2-312"><a href="#cb2-312" aria-hidden="true" tabindex="-1"></a>         <span class="at">Nationality =</span> <span class="fu">factor</span>(Nationality)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-313"><a href="#cb2-313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(PseudoID, Infection.Count) <span class="sc">%&gt;%</span>   </span>
<span id="cb2-314"><a href="#cb2-314" aria-hidden="true" tabindex="-1"></a>  <span class="co"># as.data.table() %&gt;%</span></span>
<span id="cb2-315"><a href="#cb2-315" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Collection.Date =</span> <span class="fu">first</span>(CollectionDateTime),</span>
<span id="cb2-316"><a href="#cb2-316" aria-hidden="true" tabindex="-1"></a>            <span class="at">Age =</span> <span class="fu">first</span>(Age[<span class="sc">!</span><span class="fu">is.na</span>(Age)]),</span>
<span id="cb2-317"><a href="#cb2-317" aria-hidden="true" tabindex="-1"></a>            <span class="at">Gender =</span> <span class="fu">first</span>(Gender),</span>
<span id="cb2-318"><a href="#cb2-318" aria-hidden="true" tabindex="-1"></a>            <span class="at">Nationality =</span> Nationality[<span class="fu">which</span>((Nationality <span class="sc">%in%</span> <span class="fu">c</span>(nationalities)))[<span class="dv">1</span>]],</span>
<span id="cb2-319"><a href="#cb2-319" aria-hidden="true" tabindex="-1"></a>            <span class="at">Vaccination.Status =</span> <span class="fu">first</span>(VaccinationStatus),</span>
<span id="cb2-320"><a href="#cb2-320" aria-hidden="true" tabindex="-1"></a>            <span class="at">NoOfDoses =</span> <span class="fu">first</span>(NoOfDoses),</span>
<span id="cb2-321"><a href="#cb2-321" aria-hidden="true" tabindex="-1"></a>            <span class="at">Comorbidities =</span> <span class="fu">first</span>(Comorbities),</span>
<span id="cb2-322"><a href="#cb2-322" aria-hidden="true" tabindex="-1"></a>            <span class="at">Lineage.Hospitalised =</span> <span class="fu">first</span>(LineageHospitalized),</span>
<span id="cb2-323"><a href="#cb2-323" aria-hidden="true" tabindex="-1"></a>            <span class="at">Hospital_admission_dttm =</span> Date_hospitalization[<span class="fu">which</span>(Date_hospitalization <span class="sc">!=</span> <span class="st">""</span>)[<span class="dv">1</span>]],</span>
<span id="cb2-324"><a href="#cb2-324" aria-hidden="true" tabindex="-1"></a>            <span class="at">Hospital_discharge_dttm =</span> hospital_discharge_date[<span class="fu">which</span>(hospital_discharge_date <span class="sc">!=</span> <span class="st">""</span>)[<span class="dv">1</span>]],</span>
<span id="cb2-325"><a href="#cb2-325" aria-hidden="true" tabindex="-1"></a>            <span class="at">Death =</span> <span class="fu">first</span>(IsDied),</span>
<span id="cb2-326"><a href="#cb2-326" aria-hidden="true" tabindex="-1"></a>            <span class="at">DeathDate =</span> Death_Date[<span class="fu">which</span>(Death_Date <span class="sc">!=</span> <span class="st">""</span>)[<span class="dv">1</span>]],</span>
<span id="cb2-327"><a href="#cb2-327" aria-hidden="true" tabindex="-1"></a>            <span class="at">Sequenced =</span> <span class="fu">first</span>(Sequenced),</span>
<span id="cb2-328"><a href="#cb2-328" aria-hidden="true" tabindex="-1"></a>            <span class="at">Lineage =</span> Lineage.Short[<span class="fu">which</span>(Lineage.Short <span class="sc">!=</span> <span class="st">""</span>)[<span class="dv">1</span>]],</span>
<span id="cb2-329"><a href="#cb2-329" aria-hidden="true" tabindex="-1"></a>            <span class="at">Travel.Country =</span> Tableau_Travel_Country_Name[<span class="fu">which</span>((Tableau_Travel_Country_Name <span class="sc">%in%</span> countries))[<span class="dv">1</span>]],</span>
<span id="cb2-330"><a href="#cb2-330" aria-hidden="true" tabindex="-1"></a>            <span class="at">Travel.History =</span> Tableau_Travel_Country_Name[<span class="fu">which</span>(Tableau_Travel_Country_Name <span class="sc">%in%</span> travel_history)[<span class="dv">1</span>]],</span>
<span id="cb2-331"><a href="#cb2-331" aria-hidden="true" tabindex="-1"></a>            <span class="at">Tableau.ICU.Status =</span> Tableau_ICU_Status[<span class="fu">which</span>((Tableau_ICU_Status <span class="sc">%in%</span> tableau_ICU_Status))[<span class="dv">1</span>]],</span>
<span id="cb2-332"><a href="#cb2-332" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Tableau.ICU.Status = first(Tableau_ICU_Status),</span></span>
<span id="cb2-333"><a href="#cb2-333" aria-hidden="true" tabindex="-1"></a>            <span class="at">Performing.Facility =</span> <span class="fu">first</span>(Performing.Facility)) </span>
<span id="cb2-334"><a href="#cb2-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-335"><a href="#cb2-335" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-336"><a href="#cb2-336" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-337"><a href="#cb2-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-338"><a href="#cb2-338" aria-hidden="true" tabindex="-1"></a><span class="in">```{r convert-datalineages-to-dt}</span></span>
<span id="cb2-339"><a href="#cb2-339" aria-hidden="true" tabindex="-1"></a>data.lineages.dt <span class="ot">&lt;-</span> data.lineages <span class="sc">%&gt;%</span> </span>
<span id="cb2-340"><a href="#cb2-340" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># slice_head(n = 1000) %&gt;%</span></span>
<span id="cb2-341"><a href="#cb2-341" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">mutate</span>(<span class="at">CollectionDateTime =</span> <span class="fu">as.Date</span>(CollectionDateTime)) <span class="sc">%&gt;%</span></span>
<span id="cb2-342"><a href="#cb2-342" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">as.data.table</span>()</span>
<span id="cb2-343"><a href="#cb2-343" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-344"><a href="#cb2-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-345"><a href="#cb2-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-346"><a href="#cb2-346" aria-hidden="true" tabindex="-1"></a><span class="in">```{r Calculate lag times}</span></span>
<span id="cb2-347"><a href="#cb2-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-348"><a href="#cb2-348" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(data.lineages.dt, CollectionDateTime)</span>
<span id="cb2-349"><a href="#cb2-349" aria-hidden="true" tabindex="-1"></a>data.lineages.dt <span class="ot">=</span> data.lineages.dt[, time_lag <span class="sc">:</span><span class="er">=</span> <span class="fu">c</span>(<span class="fu">as.Date</span>(<span class="cn">NA</span>), CollectionDateTime[<span class="sc">-</span><span class="fu">length</span>(CollectionDateTime)]), by <span class="ot">=</span> <span class="st">"PseudoID"</span>][, time_diff <span class="sc">:</span><span class="er">=</span> <span class="fu">difftime</span>(CollectionDateTime, time_lag, <span class="at">units =</span> <span class="st">"days"</span>)][,timeDiff.days <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(time_diff, <span class="at">units =</span> <span class="st">"days"</span>)][,timeDiff <span class="sc">:</span><span class="er">=</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(timeDiff.days), <span class="dv">0</span>, timeDiff.days)][,groupID <span class="sc">:</span><span class="er">=</span> <span class="fu">if_else</span>(timeDiff <span class="sc">&gt;</span> threshold_days, <span class="dv">1</span>, <span class="dv">0</span>)][,Infection.Count <span class="sc">:</span><span class="er">=</span> <span class="fu">cumsum</span>(groupID)<span class="sc">+</span><span class="dv">1</span>, by <span class="ot">=</span> <span class="st">"PseudoID"</span>]</span>
<span id="cb2-350"><a href="#cb2-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-351"><a href="#cb2-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-352"><a href="#cb2-352" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-353"><a href="#cb2-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-354"><a href="#cb2-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-355"><a href="#cb2-355" aria-hidden="true" tabindex="-1"></a><span class="in">```{r remove-duplicates-more-efficiently}</span></span>
<span id="cb2-356"><a href="#cb2-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-357"><a href="#cb2-357" aria-hidden="true" tabindex="-1"></a>data.lineages.cleaned.dt <span class="ot">&lt;-</span> data.lineages.dt <span class="sc">%&gt;%</span> </span>
<span id="cb2-358"><a href="#cb2-358" aria-hidden="true" tabindex="-1"></a>  <span class="co"># as.data.frame() %&gt;%</span></span>
<span id="cb2-359"><a href="#cb2-359" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(PseudoID, Infection.Count) <span class="sc">%&gt;%</span>   </span>
<span id="cb2-360"><a href="#cb2-360" aria-hidden="true" tabindex="-1"></a>  <span class="co"># as.data.table() %&gt;%</span></span>
<span id="cb2-361"><a href="#cb2-361" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Collection.Date =</span> <span class="fu">first</span>(CollectionDateTime),</span>
<span id="cb2-362"><a href="#cb2-362" aria-hidden="true" tabindex="-1"></a>            <span class="at">Age =</span> <span class="fu">first</span>(Age[<span class="sc">!</span><span class="fu">is.na</span>(Age)]),</span>
<span id="cb2-363"><a href="#cb2-363" aria-hidden="true" tabindex="-1"></a>            <span class="at">Gender =</span> <span class="fu">first</span>(Gender),</span>
<span id="cb2-364"><a href="#cb2-364" aria-hidden="true" tabindex="-1"></a>            <span class="at">Nationality =</span> Nationality[<span class="fu">which</span>((Nationality <span class="sc">%in%</span> <span class="fu">c</span>(nationalities)))[<span class="dv">1</span>]],</span>
<span id="cb2-365"><a href="#cb2-365" aria-hidden="true" tabindex="-1"></a>            <span class="at">Vaccination.Status =</span> <span class="fu">first</span>(VaccinationStatus),</span>
<span id="cb2-366"><a href="#cb2-366" aria-hidden="true" tabindex="-1"></a>            <span class="at">NoOfDoses =</span> <span class="fu">first</span>(NoOfDoses),</span>
<span id="cb2-367"><a href="#cb2-367" aria-hidden="true" tabindex="-1"></a>            <span class="at">Comorbidities =</span> <span class="fu">first</span>(Comorbities),</span>
<span id="cb2-368"><a href="#cb2-368" aria-hidden="true" tabindex="-1"></a>            <span class="at">Hospital_admission_dttm =</span> Date_hospitalization[<span class="fu">which</span>(Date_hospitalization <span class="sc">!=</span> <span class="st">""</span>)[<span class="dv">1</span>]],</span>
<span id="cb2-369"><a href="#cb2-369" aria-hidden="true" tabindex="-1"></a>            <span class="at">Hospital_discharge_dttm =</span> hospital_discharge_date[<span class="fu">which</span>(hospital_discharge_date <span class="sc">!=</span> <span class="st">""</span>)[<span class="dv">1</span>]],</span>
<span id="cb2-370"><a href="#cb2-370" aria-hidden="true" tabindex="-1"></a>            <span class="at">Death =</span> <span class="fu">first</span>(IsDied),</span>
<span id="cb2-371"><a href="#cb2-371" aria-hidden="true" tabindex="-1"></a>            <span class="at">DeathDate =</span> Death_Date[<span class="fu">which</span>(Death_Date <span class="sc">!=</span> <span class="st">""</span>)[<span class="dv">1</span>]],</span>
<span id="cb2-372"><a href="#cb2-372" aria-hidden="true" tabindex="-1"></a>            <span class="at">Sequenced =</span> Sequenced[<span class="fu">which</span>(Sequenced <span class="sc">==</span> <span class="dv">1</span>)[<span class="dv">1</span>]],</span>
<span id="cb2-373"><a href="#cb2-373" aria-hidden="true" tabindex="-1"></a>            <span class="at">Lineage =</span> Lineage.Short[<span class="fu">which</span>(Lineage.Short <span class="sc">!=</span> <span class="st">""</span>)[<span class="dv">1</span>]],</span>
<span id="cb2-374"><a href="#cb2-374" aria-hidden="true" tabindex="-1"></a>            <span class="at">Travel.Country =</span> Tableau_Travel_Country_Name[<span class="fu">which</span>(Tableau_Travel_Country_Name <span class="sc">%in%</span> countries)[<span class="dv">1</span>]],</span>
<span id="cb2-375"><a href="#cb2-375" aria-hidden="true" tabindex="-1"></a>            <span class="at">Travel.History =</span> Tableau_Travel_Country_Name[<span class="fu">which</span>(Tableau_Travel_Country_Name <span class="sc">%in%</span> travel_history)[<span class="dv">1</span>]],</span>
<span id="cb2-376"><a href="#cb2-376" aria-hidden="true" tabindex="-1"></a>            <span class="at">Tableau.ICU.Status =</span> Tableau_ICU_Status[<span class="fu">which</span>((Tableau_ICU_Status <span class="sc">%in%</span> tableau_ICU_Status))[<span class="dv">1</span>]],</span>
<span id="cb2-377"><a href="#cb2-377" aria-hidden="true" tabindex="-1"></a>            <span class="at">Performing.Facility =</span> Performing.Facility[<span class="fu">which</span>(Performing.Facility <span class="sc">!=</span> <span class="st">""</span>)[<span class="dv">1</span>]]) </span>
<span id="cb2-378"><a href="#cb2-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-379"><a href="#cb2-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-380"><a href="#cb2-380" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-381"><a href="#cb2-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-382"><a href="#cb2-382" aria-hidden="true" tabindex="-1"></a>After cleaning the data, we can check how many times a person is repeated in Table \@ref(tab:duplicate-ids-cleaned-check). </span>
<span id="cb2-383"><a href="#cb2-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-384"><a href="#cb2-384" aria-hidden="true" tabindex="-1"></a><span class="in">```{r duplicate-ids-cleaned-check}</span></span>
<span id="cb2-385"><a href="#cb2-385" aria-hidden="true" tabindex="-1"></a>patient.multiple.records.cleaned <span class="ot">&lt;-</span> data.lineages.cleaned.dt <span class="sc">%&gt;%</span> </span>
<span id="cb2-386"><a href="#cb2-386" aria-hidden="true" tabindex="-1"></a>                                          <span class="co"># filter(Performing.Facility == "SK Sheikh Khalifa Medical City") %&gt;%</span></span>
<span id="cb2-387"><a href="#cb2-387" aria-hidden="true" tabindex="-1"></a>                                              <span class="co"># filter(Sequenced == 1) %&gt;% </span></span>
<span id="cb2-388"><a href="#cb2-388" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">group_by</span>(PseudoID) <span class="sc">%&gt;%</span> </span>
<span id="cb2-389"><a href="#cb2-389" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">summarise</span>(<span class="at">Count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb2-390"><a href="#cb2-390" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">filter</span>(Count<span class="sc">&gt;</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-391"><a href="#cb2-391" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">arrange</span>(<span class="fu">desc</span>(Count)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-392"><a href="#cb2-392" aria-hidden="true" tabindex="-1"></a>                                              <span class="co"># slice(1:5, 30:35, (n()-5):n())</span></span>
<span id="cb2-393"><a href="#cb2-393" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb2-394"><a href="#cb2-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-395"><a href="#cb2-395" aria-hidden="true" tabindex="-1"></a>patient.multiple.records.cleaned <span class="sc">%&gt;%</span></span>
<span id="cb2-396"><a href="#cb2-396" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">booktabs =</span> T, <span class="at">escape =</span> F, <span class="at">format.args =</span> <span class="fu">list</span>(<span class="at">big.mark =</span> <span class="st">","</span>),</span>
<span id="cb2-397"><a href="#cb2-397" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"Number of records per ID number of the 10 most repeated records in the database."</span>),</span>
<span id="cb2-398"><a href="#cb2-398" aria-hidden="true" tabindex="-1"></a>                                  <span class="co"># digits = c(0, rep(c(rep(0,3),rep(3,3)), length(labelsW))), </span></span>
<span id="cb2-399"><a href="#cb2-399" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"PseudoID"</span>, <span class="st">"# records"</span>),</span>
<span id="cb2-400"><a href="#cb2-400" aria-hidden="true" tabindex="-1"></a>                                  <span class="co"># width = 12,</span></span>
<span id="cb2-401"><a href="#cb2-401" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">align =</span> <span class="fu">c</span>(<span class="st">'l'</span>,<span class="st">'c'</span>))  <span class="sc">%&gt;%</span></span>
<span id="cb2-402"><a href="#cb2-402" aria-hidden="true" tabindex="-1"></a>                                  <span class="co"># row_spec(0, bold=TRUE)</span></span>
<span id="cb2-403"><a href="#cb2-403" aria-hidden="true" tabindex="-1"></a>                           kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="fu">c</span>(<span class="st">"striped"</span>,<span class="st">"hover"</span>), <span class="at">full_width =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb2-404"><a href="#cb2-404" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">column_spec</span>(<span class="at">column =</span> <span class="dv">1</span>, <span class="at">extra_css =</span> <span class="st">"position: absolute"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-405"><a href="#cb2-405" aria-hidden="true" tabindex="-1"></a>                           <span class="co"># column_spec(column = 1:length(colnames_allTable), width = "12em; min-width: 8em;") %&gt;%</span></span>
<span id="cb2-406"><a href="#cb2-406" aria-hidden="true" tabindex="-1"></a>                           kableExtra<span class="sc">::</span><span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"100%"</span>, <span class="at">fixed_thead =</span> T)</span>
<span id="cb2-407"><a href="#cb2-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-408"><a href="#cb2-408" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-409"><a href="#cb2-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-410"><a href="#cb2-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-411"><a href="#cb2-411" aria-hidden="true" tabindex="-1"></a>In addition, we can check also if the record of the patient shown in Table \@ref(tab:patient-multiple-records) has become the expected record in Table \@ref(tab:patient-multiple-records-cleaned):</span>
<span id="cb2-412"><a href="#cb2-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-413"><a href="#cb2-413" aria-hidden="true" tabindex="-1"></a><span class="in">```{r patient-multiple-records-cleaned}</span></span>
<span id="cb2-414"><a href="#cb2-414" aria-hidden="true" tabindex="-1"></a><span class="co"># patientID &lt;- "{92E11469-6664-4C51-B14B-45C1844C6761}"</span></span>
<span id="cb2-415"><a href="#cb2-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-416"><a href="#cb2-416" aria-hidden="true" tabindex="-1"></a>data.lineages.cleaned.dt <span class="sc">%&gt;%</span> <span class="fu">filter</span>(PseudoID <span class="sc">%in%</span> patientID) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2-417"><a href="#cb2-417" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Collection.Date, Nationality, Age, Lineage, Travel.History, Tableau.ICU.Status, Performing.Facility, Sequenced) <span class="sc">%&gt;%</span> </span>
<span id="cb2-418"><a href="#cb2-418" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">booktabs =</span> T, <span class="at">escape =</span> F, <span class="at">format.args =</span> <span class="fu">list</span>(<span class="at">big.mark =</span> <span class="st">","</span>),</span>
<span id="cb2-419"><a href="#cb2-419" aria-hidden="true" tabindex="-1"></a>               <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"Different records for the same infection(s) for patient with PseudoID"</span>, patientID)) <span class="sc">%&gt;%</span></span>
<span id="cb2-420"><a href="#cb2-420" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="fu">c</span>(<span class="st">"striped"</span>,<span class="st">"hover"</span>), <span class="at">full_width =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb2-421"><a href="#cb2-421" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="at">column =</span> <span class="dv">1</span>, <span class="at">extra_css =</span> <span class="st">"position: absolute"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-422"><a href="#cb2-422" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"100%"</span>, <span class="at">fixed_thead =</span> T)  </span>
<span id="cb2-423"><a href="#cb2-423" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-424"><a href="#cb2-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-425"><a href="#cb2-425" aria-hidden="true" tabindex="-1"></a>The distribution of lineages after the removal of duplicate records is shown in Figure \@ref(fig:remove-duplicate-records-plot):</span>
<span id="cb2-426"><a href="#cb2-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-427"><a href="#cb2-427" aria-hidden="true" tabindex="-1"></a><span class="in">```{r remove-duplicate-records-plot, include = T, fig.cap= "Number of people sequenced per variant after data cleaning. Only those variants that were sequenced with more than records per lineage are shown."}</span></span>
<span id="cb2-428"><a href="#cb2-428" aria-hidden="true" tabindex="-1"></a>data.lineages.cleaned.dt <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Sequenced <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-429"><a href="#cb2-429" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">group_by</span>(Lineage) <span class="sc">%&gt;%</span> </span>
<span id="cb2-430"><a href="#cb2-430" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(n <span class="sc">&gt;</span> min_n_variant) <span class="sc">%&gt;%</span></span>
<span id="cb2-431"><a href="#cb2-431" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Lineage, <span class="at">y =</span> n, <span class="at">fill =</span> Lineage)) <span class="sc">+</span></span>
<span id="cb2-432"><a href="#cb2-432" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_col(aes(fill = Lineage.Short)) + </span></span>
<span id="cb2-433"><a href="#cb2-433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>,  <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb2-434"><a href="#cb2-434" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>n), <span class="at">position=</span><span class="fu">position_dodge</span>(<span class="at">width=</span><span class="fl">0.9</span>), <span class="at">vjust=</span><span class="sc">-</span><span class="fl">0.25</span>, <span class="at">size=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb2-435"><a href="#cb2-435" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> comma) <span class="sc">+</span></span>
<span id="cb2-436"><a href="#cb2-436" aria-hidden="true" tabindex="-1"></a>          <span class="fu">xlab</span>(<span class="st">"Lineage sequenced"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"# people"</span>) <span class="sc">+</span></span>
<span id="cb2-437"><a href="#cb2-437" aria-hidden="true" tabindex="-1"></a>          <span class="fu">ggtitle</span>(<span class="st">"Number of people sequenced per variant (after data cleaning)"</span>)</span>
<span id="cb2-438"><a href="#cb2-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-439"><a href="#cb2-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-440"><a href="#cb2-440" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-441"><a href="#cb2-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-442"><a href="#cb2-442" aria-hidden="true" tabindex="-1"></a>With the lineages unified and the duplicates removed, we can go ahead and study the data.</span>
<span id="cb2-443"><a href="#cb2-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-444"><a href="#cb2-444" aria-hidden="true" tabindex="-1"></a><span class="in">```{r conversion-to-correct-variables}</span></span>
<span id="cb2-445"><a href="#cb2-445" aria-hidden="true" tabindex="-1"></a><span class="co"># if (!file.exists(filename)){</span></span>
<span id="cb2-446"><a href="#cb2-446" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(use_dplyr){</span>
<span id="cb2-447"><a href="#cb2-447" aria-hidden="true" tabindex="-1"></a>final.data.cleaned <span class="ot">&lt;-</span> data.lineages.cleaned.dt <span class="sc">%&gt;%</span> </span>
<span id="cb2-448"><a href="#cb2-448" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">mutate</span>(<span class="at">Sequenced.Flag =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Sequenced), <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb2-449"><a href="#cb2-449" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">Hospitalised =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(Hospital_admission_dttm), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb2-450"><a href="#cb2-450" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">Travel.Flag =</span> <span class="fu">ifelse</span>(Travel.History <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">|</span> <span class="sc">!</span><span class="fu">is.na</span>(Travel.Country), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb2-451"><a href="#cb2-451" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">Traveled =</span> <span class="fu">ifelse</span>(Travel.Flag <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>),</span>
<span id="cb2-452"><a href="#cb2-452" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">Sequenced =</span> <span class="fu">ifelse</span>(Sequenced.Flag <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"Sequenced"</span>, <span class="st">"Not Sequenced"</span>),</span>
<span id="cb2-453"><a href="#cb2-453" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">Reason.for.Sequencing =</span> <span class="fu">case_when</span>(Tableau.ICU.Status <span class="sc">==</span> <span class="st">"ICU"</span> <span class="sc">|</span> Tableau.ICU.Status <span class="sc">==</span> <span class="st">"HDU"</span> <span class="sc">~</span> <span class="st">"ICU/HDU"</span>,</span>
<span id="cb2-454"><a href="#cb2-454" aria-hidden="true" tabindex="-1"></a>                                   Travel.History <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">~</span> <span class="st">"Travel"</span>,</span>
<span id="cb2-455"><a href="#cb2-455" aria-hidden="true" tabindex="-1"></a>                                   <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Community Surveillance"</span>))  </span>
<span id="cb2-456"><a href="#cb2-456" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb2-457"><a href="#cb2-457" aria-hidden="true" tabindex="-1"></a>final.data.cleaned <span class="ot">&lt;-</span> <span class="fu">data.table</span>(data.lineages.cleaned.dt)</span>
<span id="cb2-458"><a href="#cb2-458" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-459"><a href="#cb2-459" aria-hidden="true" tabindex="-1"></a>final.data.cleaned[, Nationality <span class="sc">:</span><span class="er">=</span> <span class="fu">case_when</span>(Nationality <span class="sc">==</span> <span class="st">"National"</span> <span class="sc">|</span> Nationality <span class="sc">==</span> <span class="st">"Emirati"</span> <span class="sc">~</span> <span class="st">"UNITED ARAB EMIRATES"</span>, </span>
<span id="cb2-460"><a href="#cb2-460" aria-hidden="true" tabindex="-1"></a>                                              Nationality <span class="sc">==</span> <span class="st">"Indian"</span> <span class="sc">~</span> <span class="st">"INDIAN"</span>,</span>
<span id="cb2-461"><a href="#cb2-461" aria-hidden="true" tabindex="-1"></a>                                              <span class="cn">TRUE</span> <span class="sc">~</span> Nationality)][,Sequenced.Flag <span class="sc">:</span><span class="er">=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Sequenced), <span class="dv">0</span>, <span class="dv">1</span>)][,Travel.Flag <span class="sc">:</span><span class="er">=</span> <span class="fu">ifelse</span>(Travel.History <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">|</span> <span class="sc">!</span><span class="fu">is.na</span>(Travel.Country), <span class="dv">1</span>, <span class="dv">0</span>)][,Traveled <span class="sc">:</span><span class="er">=</span> <span class="fu">ifelse</span>(Travel.Flag <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>)][,Sequenced <span class="sc">:</span><span class="er">=</span> <span class="fu">ifelse</span>(Sequenced.Flag <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"Sequenced"</span>, <span class="st">"Not Sequenced"</span>)][,Reason.for.Sequencing <span class="sc">:</span><span class="er">=</span> <span class="fu">case_when</span>(Tableau.ICU.Status <span class="sc">==</span> <span class="st">"ICU"</span> <span class="sc">|</span> Tableau.ICU.Status <span class="sc">==</span> <span class="st">"HDU"</span> <span class="sc">|</span> Tableau.ICU.Status <span class="sc">==</span> <span class="st">"DECEASED"</span> <span class="sc">~</span> <span class="st">"ICU/HDU/Death"</span>,</span>
<span id="cb2-462"><a href="#cb2-462" aria-hidden="true" tabindex="-1"></a>                                   Travel.History <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">~</span> <span class="st">"Travel"</span>,</span>
<span id="cb2-463"><a href="#cb2-463" aria-hidden="true" tabindex="-1"></a>                                   <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Community Surveillance"</span>)][, year_week <span class="sc">:</span><span class="er">=</span> <span class="fu">floor_date</span>(Collection.Date, <span class="st">"1 week"</span>)][, year_month <span class="sc">:</span><span class="er">=</span> <span class="fu">floor_date</span>(Collection.Date, <span class="st">"1 month"</span>)][,Performing.Facility <span class="sc">:</span><span class="er">=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Performing.Facility), <span class="st">""</span>, Performing.Facility)]</span>
<span id="cb2-464"><a href="#cb2-464" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-465"><a href="#cb2-465" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb2-466"><a href="#cb2-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-467"><a href="#cb2-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-468"><a href="#cb2-468" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Columns to convert to proper variable types</span></span>
<span id="cb2-469"><a href="#cb2-469" aria-hidden="true" tabindex="-1"></a>  colnames_date <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"DeathDate"</span>) </span>
<span id="cb2-470"><a href="#cb2-470" aria-hidden="true" tabindex="-1"></a>  colnames_dttm <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Hospital_discharge_dttm"</span>, <span class="st">"Hospital_admission_dttm"</span>) </span>
<span id="cb2-471"><a href="#cb2-471" aria-hidden="true" tabindex="-1"></a>  colnames_fct  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Vaccination.Status"</span>, <span class="st">"NoOfDoses"</span>, <span class="st">"Hospitalised"</span>, <span class="st">"Death"</span>, <span class="st">"Gender"</span>, <span class="st">"Nationality"</span>, </span>
<span id="cb2-472"><a href="#cb2-472" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Tableau.ICU.Status"</span>, <span class="st">"Traveled"</span>, </span>
<span id="cb2-473"><a href="#cb2-473" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Performing.Facility"</span>, <span class="st">"Lineage"</span>, <span class="st">"Sequenced"</span>, <span class="st">"Reason.for.Sequencing"</span>)</span>
<span id="cb2-474"><a href="#cb2-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-475"><a href="#cb2-475" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-476"><a href="#cb2-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-477"><a href="#cb2-477" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Change class for date columns</span></span>
<span id="cb2-478"><a href="#cb2-478" aria-hidden="true" tabindex="-1"></a>  final.data.cleaned <span class="ot">&lt;-</span> final.data.cleaned[ ,(colnames_date) <span class="sc">:</span><span class="er">=</span> <span class="fu">lapply</span>(.SD, as.Date),</span>
<span id="cb2-479"><a href="#cb2-479" aria-hidden="true" tabindex="-1"></a>                                             .SDcols <span class="ot">=</span> colnames_date]  </span>
<span id="cb2-480"><a href="#cb2-480" aria-hidden="true" tabindex="-1"></a>  final.data.cleaned <span class="ot">&lt;-</span> final.data.cleaned[ ,(colnames_dttm) <span class="sc">:</span><span class="er">=</span> <span class="fu">lapply</span>(.SD, <span class="cf">function</span>(x){<span class="fu">as.POSIXct</span>(x, <span class="at">format =</span> <span class="st">"%Y-%m-%d %H:%M:%OS"</span>)}),</span>
<span id="cb2-481"><a href="#cb2-481" aria-hidden="true" tabindex="-1"></a>                                              .SDcols <span class="ot">=</span> colnames_dttm]  </span>
<span id="cb2-482"><a href="#cb2-482" aria-hidden="true" tabindex="-1"></a>  final.data.cleaned[,Hospitalised <span class="sc">:</span><span class="er">=</span> <span class="fu">ifelse</span>(Hospital_admission_dttm <span class="sc">&lt;</span> Collection.Date <span class="sc">+</span> <span class="dv">30</span> <span class="sc">&amp;</span> Hospital_admission_dttm  <span class="sc">&gt;</span> Collection.Date <span class="sc">-</span> <span class="dv">7</span>  , <span class="dv">1</span>, <span class="dv">0</span>)][,Hospitalised <span class="sc">:</span><span class="er">=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Hospitalised), <span class="dv">0</span>, Hospitalised)]                                       </span>
<span id="cb2-483"><a href="#cb2-483" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Change class for factor columns</span></span>
<span id="cb2-484"><a href="#cb2-484" aria-hidden="true" tabindex="-1"></a>  final.data.cleaned <span class="ot">&lt;-</span> final.data.cleaned[ ,(colnames_fct) <span class="sc">:</span><span class="er">=</span> <span class="fu">lapply</span>(.SD, as.factor),</span>
<span id="cb2-485"><a href="#cb2-485" aria-hidden="true" tabindex="-1"></a>                                             .SDcols <span class="ot">=</span> colnames_fct]  </span>
<span id="cb2-486"><a href="#cb2-486" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-487"><a href="#cb2-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-488"><a href="#cb2-488" aria-hidden="true" tabindex="-1"></a><span class="in">```{r store-common-lineages}</span></span>
<span id="cb2-489"><a href="#cb2-489" aria-hidden="true" tabindex="-1"></a>common.lineages <span class="ot">&lt;-</span> final.data.cleaned <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Sequenced <span class="sc">==</span> <span class="st">"Sequenced"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-490"><a href="#cb2-490" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">group_by</span>(Lineage) <span class="sc">%&gt;%</span> </span>
<span id="cb2-491"><a href="#cb2-491" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb2-492"><a href="#cb2-492" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">filter</span>(n <span class="sc">&gt;</span> min_n_variant) <span class="sc">%&gt;%</span> </span>
<span id="cb2-493"><a href="#cb2-493" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">pull</span>(Lineage)</span>
<span id="cb2-494"><a href="#cb2-494" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-495"><a href="#cb2-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-496"><a href="#cb2-496" aria-hidden="true" tabindex="-1"></a><span class="fu">## Comparison between sequenced and non-sequenced samples </span></span>
<span id="cb2-497"><a href="#cb2-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-498"><a href="#cb2-498" aria-hidden="true" tabindex="-1"></a>One important aspect to compare population sequenced vs. non-sequenced is to see how the compare in terms of age. This will be shown the following subsections </span>
<span id="cb2-499"><a href="#cb2-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-500"><a href="#cb2-500" aria-hidden="true" tabindex="-1"></a><span class="fu">### Age group distribution of sequenced and non-sequenced samples</span></span>
<span id="cb2-501"><a href="#cb2-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-502"><a href="#cb2-502" aria-hidden="true" tabindex="-1"></a>Once we have separated the sequenced with the non-sequenced data we can compare the distribution of cases for the not sequenced people. This will be compared with the sequenced data. This show in Figure \@ref(fig:group-by-age-density):</span>
<span id="cb2-503"><a href="#cb2-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-504"><a href="#cb2-504" aria-hidden="true" tabindex="-1"></a><span class="in">```{r group-by-age-density, fig.cap= 'Density distribution of positive cases for sequenced and non-sequenced people'}</span></span>
<span id="cb2-505"><a href="#cb2-505" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogram of sequenced vs non-sequenced </span></span>
<span id="cb2-506"><a href="#cb2-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-507"><a href="#cb2-507" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Density plot</span></span>
<span id="cb2-508"><a href="#cb2-508" aria-hidden="true" tabindex="-1"></a>final.data.cleaned <span class="sc">%&gt;%</span>  </span>
<span id="cb2-509"><a href="#cb2-509" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Age, <span class="at">fill =</span> Sequenced)) <span class="sc">+</span> </span>
<span id="cb2-510"><a href="#cb2-510" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">geom_density</span>(<span class="at">alpha =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb2-511"><a href="#cb2-511" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># geom_histogram(bins = 30) + </span></span>
<span id="cb2-512"><a href="#cb2-512" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">ylab</span>(<span class="st">"Density"</span>) <span class="sc">+</span></span>
<span id="cb2-513"><a href="#cb2-513" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>))  <span class="sc">+</span> </span>
<span id="cb2-514"><a href="#cb2-514" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">scale_fill_discrete</span>(<span class="at">name =</span> <span class="st">"Sequenced"</span>) <span class="sc">+</span></span>
<span id="cb2-515"><a href="#cb2-515" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> comma) <span class="sc">+</span></span>
<span id="cb2-516"><a href="#cb2-516" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">ggtitle</span>(<span class="st">"Density distribution of positive cases per sequencing group"</span>)</span>
<span id="cb2-517"><a href="#cb2-517" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-518"><a href="#cb2-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-519"><a href="#cb2-519" aria-hidden="true" tabindex="-1"></a>We can see also the total count for sequenced and non-sequenced groups in Figure \@ref(fig:group-by-age-histogram):</span>
<span id="cb2-520"><a href="#cb2-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-521"><a href="#cb2-521" aria-hidden="true" tabindex="-1"></a><span class="in">```{r group-by-age-histogram, fig.cap= 'Histogram fo the distribution of positive cases for sequenced and non-sequenced people'}</span></span>
<span id="cb2-522"><a href="#cb2-522" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Histogram plot (stacked bars)</span></span>
<span id="cb2-523"><a href="#cb2-523" aria-hidden="true" tabindex="-1"></a>final.data.cleaned <span class="sc">%&gt;%</span>  </span>
<span id="cb2-524"><a href="#cb2-524" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Age, <span class="at">fill =</span> Sequenced)) <span class="sc">+</span> </span>
<span id="cb2-525"><a href="#cb2-525" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">geom_histogram</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb2-526"><a href="#cb2-526" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># geom_histogram(bins = 30) + </span></span>
<span id="cb2-527"><a href="#cb2-527" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">ylab</span>(<span class="st">"# of positives"</span>) <span class="sc">+</span></span>
<span id="cb2-528"><a href="#cb2-528" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>)) <span class="sc">+</span> </span>
<span id="cb2-529"><a href="#cb2-529" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">scale_fill_discrete</span>(<span class="at">name =</span> <span class="st">"Sequenced"</span>) <span class="sc">+</span></span>
<span id="cb2-530"><a href="#cb2-530" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> comma) <span class="sc">+</span></span>
<span id="cb2-531"><a href="#cb2-531" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">ggtitle</span>(<span class="st">"Distribution of positive cases per age group (stacked bars)"</span>)</span>
<span id="cb2-532"><a href="#cb2-532" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb2-533"><a href="#cb2-533" aria-hidden="true" tabindex="-1"></a><span class="co"># # 3. Histogram plot with separated bars </span></span>
<span id="cb2-534"><a href="#cb2-534" aria-hidden="true" tabindex="-1"></a><span class="co"># omicron.data.recoded %&gt;%  </span></span>
<span id="cb2-535"><a href="#cb2-535" aria-hidden="true" tabindex="-1"></a><span class="co">#                         filter(!is.na(Sequenced == 0), Age &gt;= 0) %&gt;% </span></span>
<span id="cb2-536"><a href="#cb2-536" aria-hidden="true" tabindex="-1"></a><span class="co">#                         ggplot(aes(x = Age)) + </span></span>
<span id="cb2-537"><a href="#cb2-537" aria-hidden="true" tabindex="-1"></a><span class="co">#                             geom_histogram(data = subset(omicron.data.recoded, Sequenced == 1), color = "black", fill = "maroon",alpha = .5) +</span></span>
<span id="cb2-538"><a href="#cb2-538" aria-hidden="true" tabindex="-1"></a><span class="co">#                             geom_histogram(data = subset(omicron.data.recoded, Sequenced == 0), color = "black", fill = "steelblue",   alpha = .5) +</span></span>
<span id="cb2-539"><a href="#cb2-539" aria-hidden="true" tabindex="-1"></a><span class="co">#                             # geom_histogram(bins = 30) + </span></span>
<span id="cb2-540"><a href="#cb2-540" aria-hidden="true" tabindex="-1"></a><span class="co">#                             ylab("# of positives") +</span></span>
<span id="cb2-541"><a href="#cb2-541" aria-hidden="true" tabindex="-1"></a><span class="co">#                             xlim(c(0, 100)) + </span></span>
<span id="cb2-542"><a href="#cb2-542" aria-hidden="true" tabindex="-1"></a><span class="co">#                             scale_fill_discrete(name = "Sequenced")</span></span>
<span id="cb2-543"><a href="#cb2-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-544"><a href="#cb2-544" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-545"><a href="#cb2-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-546"><a href="#cb2-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-547"><a href="#cb2-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-548"><a href="#cb2-548" aria-hidden="true" tabindex="-1"></a><span class="fu">### Samples distributed by reason for sequencing</span></span>
<span id="cb2-549"><a href="#cb2-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-550"><a href="#cb2-550" aria-hidden="true" tabindex="-1"></a>We can break down the totals shown in Figure \@ref(fig:distribution-by-reason-seq) into the age distribution by reason for sequencing:</span>
<span id="cb2-551"><a href="#cb2-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-552"><a href="#cb2-552" aria-hidden="true" tabindex="-1"></a><span class="in">```{r distribution-by-reason-seq, fig.cap= 'Density distribution of positive cases per reason of sequencing for sequenced and non-sequenced people'}</span></span>
<span id="cb2-553"><a href="#cb2-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-554"><a href="#cb2-554" aria-hidden="true" tabindex="-1"></a>final.data.cleaned <span class="sc">%&gt;%</span>  </span>
<span id="cb2-555"><a href="#cb2-555" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(Sequenced == "Sequenced") %&gt;%</span></span>
<span id="cb2-556"><a href="#cb2-556" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Age, <span class="at">fill =</span> Reason.for.Sequencing)) <span class="sc">+</span> </span>
<span id="cb2-557"><a href="#cb2-557" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># geom_histogram() + </span></span>
<span id="cb2-558"><a href="#cb2-558" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">geom_density</span>(<span class="at">alpha =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb2-559"><a href="#cb2-559" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># geom_histogram(bins = 30) + </span></span>
<span id="cb2-560"><a href="#cb2-560" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">ylab</span>(<span class="st">"Density"</span>) <span class="sc">+</span></span>
<span id="cb2-561"><a href="#cb2-561" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>))  <span class="sc">+</span> </span>
<span id="cb2-562"><a href="#cb2-562" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">scale_fill_discrete</span>(<span class="at">name =</span> <span class="st">"Reason for Sequencing"</span>) <span class="sc">+</span></span>
<span id="cb2-563"><a href="#cb2-563" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> comma) <span class="sc">+</span></span>
<span id="cb2-564"><a href="#cb2-564" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">ggtitle</span>(<span class="st">"Age distribution of positive cases per cause of sequencing group"</span>) <span class="sc">+</span></span>
<span id="cb2-565"><a href="#cb2-565" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(Sequenced <span class="sc">~</span>.)</span>
<span id="cb2-566"><a href="#cb2-566" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-567"><a href="#cb2-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-568"><a href="#cb2-568" aria-hidden="true" tabindex="-1"></a><span class="fu">### Sample distribution based on nationality</span></span>
<span id="cb2-569"><a href="#cb2-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-570"><a href="#cb2-570" aria-hidden="true" tabindex="-1"></a>We can see the distribution of the samples based on their nationality in Figure \@ref(fig:distribution-by-nationality):</span>
<span id="cb2-571"><a href="#cb2-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-572"><a href="#cb2-572" aria-hidden="true" tabindex="-1"></a><span class="in">```{r distribution-by-nationality}</span></span>
<span id="cb2-573"><a href="#cb2-573" aria-hidden="true" tabindex="-1"></a>final.data.cleaned <span class="sc">%&gt;%</span> </span>
<span id="cb2-574"><a href="#cb2-574" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(!is.na(Nationality)) %&gt;% </span></span>
<span id="cb2-575"><a href="#cb2-575" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Nationality, Sequenced) <span class="sc">%&gt;%</span> </span>
<span id="cb2-576"><a href="#cb2-576" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb2-577"><a href="#cb2-577" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Sequenced) <span class="sc">%&gt;%</span> </span>
<span id="cb2-578"><a href="#cb2-578" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">per =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(per <span class="sc">&gt;=</span> <span class="fl">0.01</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-579"><a href="#cb2-579" aria-hidden="true" tabindex="-1"></a>                <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Nationality, <span class="at">y =</span> per, <span class="at">fill =</span> Sequenced)) <span class="sc">+</span> </span>
<span id="cb2-580"><a href="#cb2-580" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># geom_histogram() + </span></span>
<span id="cb2-581"><a href="#cb2-581" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb2-582"><a href="#cb2-582" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># geom_histogram(bins = 30) + </span></span>
<span id="cb2-583"><a href="#cb2-583" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">ylab</span>(<span class="st">"Density"</span>) <span class="sc">+</span></span>
<span id="cb2-584"><a href="#cb2-584" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># xlim(c(0, 100))  + </span></span>
<span id="cb2-585"><a href="#cb2-585" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># scale_fill_discrete(name = "Reason for Sequencing") +</span></span>
<span id="cb2-586"><a href="#cb2-586" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> comma) <span class="sc">+</span></span>
<span id="cb2-587"><a href="#cb2-587" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">ggtitle</span>(<span class="st">"Distribution of positive cases by nationality per sequencing group"</span>) <span class="sc">+</span></span>
<span id="cb2-588"><a href="#cb2-588" aria-hidden="true" tabindex="-1"></a>          <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb2-589"><a href="#cb2-589" aria-hidden="true" tabindex="-1"></a>                <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust=</span><span class="dv">1</span>)) </span>
<span id="cb2-590"><a href="#cb2-590" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-591"><a href="#cb2-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-592"><a href="#cb2-592" aria-hidden="true" tabindex="-1"></a>Due to the high number of labels however, it is difficult to define a significant difference for nationality regarding the samples for the sequenced and non-sequenced people.</span>
<span id="cb2-593"><a href="#cb2-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-594"><a href="#cb2-594" aria-hidden="true" tabindex="-1"></a><span class="fu">### Samples for comorbidities of sequenced and non-sequenced</span></span>
<span id="cb2-595"><a href="#cb2-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-596"><a href="#cb2-596" aria-hidden="true" tabindex="-1"></a>Another aspect that could be studied was the distribution of the samples based on their risk factor. In this case, We can see the distribution of the samples based on their comorbidities in Figures \@ref(fig:distribution-by-comorbidities-totals) and \@ref(fig:distribution-by-comorbidities):</span>
<span id="cb2-597"><a href="#cb2-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-598"><a href="#cb2-598" aria-hidden="true" tabindex="-1"></a><span class="in">```{r distribution-by-comorbidities-totals}</span></span>
<span id="cb2-599"><a href="#cb2-599" aria-hidden="true" tabindex="-1"></a>final.data.cleaned <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Comorbidities, Sequenced) <span class="sc">%&gt;%</span></span>
<span id="cb2-600"><a href="#cb2-600" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(Reason.for.Sequencing == "Community Surveillance") %&gt;%</span></span>
<span id="cb2-601"><a href="#cb2-601" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Sequenced) <span class="sc">%&gt;%</span> </span>
<span id="cb2-602"><a href="#cb2-602" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-603"><a href="#cb2-603" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Comorbidities <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-604"><a href="#cb2-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-605"><a href="#cb2-605" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(Comorbidities == 0 | Comorbidities == 1) %&gt;% </span></span>
<span id="cb2-606"><a href="#cb2-606" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Comorbidities, <span class="at">y =</span> perc, <span class="at">fill =</span> Sequenced)) <span class="sc">+</span> </span>
<span id="cb2-607"><a href="#cb2-607" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># geom_histogram() + </span></span>
<span id="cb2-608"><a href="#cb2-608" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb2-609"><a href="#cb2-609" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># geom_histogram(bins = 30) + </span></span>
<span id="cb2-610"><a href="#cb2-610" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">ylab</span>(<span class="st">"Density"</span>) <span class="sc">+</span></span>
<span id="cb2-611"><a href="#cb2-611" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># xlim(c(0, 100))  + </span></span>
<span id="cb2-612"><a href="#cb2-612" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># scale_fill_discrete(name = "Reason for Sequencing") +</span></span>
<span id="cb2-613"><a href="#cb2-613" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> comma) <span class="sc">+</span></span>
<span id="cb2-614"><a href="#cb2-614" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">ggtitle</span>(<span class="st">"Distribution of positive cases based on comorbidities per cause of sequencing group"</span>) <span class="sc">+</span></span>
<span id="cb2-615"><a href="#cb2-615" aria-hidden="true" tabindex="-1"></a>          <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb2-616"><a href="#cb2-616" aria-hidden="true" tabindex="-1"></a>                <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust=</span><span class="dv">1</span>))</span>
<span id="cb2-617"><a href="#cb2-617" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-618"><a href="#cb2-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-619"><a href="#cb2-619" aria-hidden="true" tabindex="-1"></a><span class="in">```{r distribution-by-comorbidities}</span></span>
<span id="cb2-620"><a href="#cb2-620" aria-hidden="true" tabindex="-1"></a>final.data.cleaned <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Comorbidities, Sequenced, Reason.for.Sequencing) <span class="sc">%&gt;%</span></span>
<span id="cb2-621"><a href="#cb2-621" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(Reason.for.Sequencing == "Community Surveillance") %&gt;%</span></span>
<span id="cb2-622"><a href="#cb2-622" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Sequenced) <span class="sc">%&gt;%</span> </span>
<span id="cb2-623"><a href="#cb2-623" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-624"><a href="#cb2-624" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Comorbidities <span class="sc">&gt;</span> <span class="dv">0</span>, Comorbidities <span class="sc">&lt;</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-625"><a href="#cb2-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-626"><a href="#cb2-626" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(Comorbidities == 0 | Comorbidities == 1) %&gt;% </span></span>
<span id="cb2-627"><a href="#cb2-627" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Comorbidities, <span class="at">y =</span> perc, <span class="at">fill =</span> Sequenced)) <span class="sc">+</span> </span>
<span id="cb2-628"><a href="#cb2-628" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># geom_histogram() + </span></span>
<span id="cb2-629"><a href="#cb2-629" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb2-630"><a href="#cb2-630" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># geom_histogram(bins = 30) + </span></span>
<span id="cb2-631"><a href="#cb2-631" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">ylab</span>(<span class="st">"Density"</span>) <span class="sc">+</span></span>
<span id="cb2-632"><a href="#cb2-632" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># xlim(c(0, 100))  + </span></span>
<span id="cb2-633"><a href="#cb2-633" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># scale_fill_discrete(name = "Reason for Sequencing") +</span></span>
<span id="cb2-634"><a href="#cb2-634" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> comma) <span class="sc">+</span></span>
<span id="cb2-635"><a href="#cb2-635" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">ggtitle</span>(<span class="st">"Distribution of positive cases based on comorbidities per cause of sequencing group"</span>) <span class="sc">+</span></span>
<span id="cb2-636"><a href="#cb2-636" aria-hidden="true" tabindex="-1"></a>          <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb2-637"><a href="#cb2-637" aria-hidden="true" tabindex="-1"></a>                <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust=</span><span class="dv">1</span>)) <span class="sc">+</span> <span class="fu">facet_grid</span>(Reason.for.Sequencing <span class="sc">~</span> .)</span>
<span id="cb2-638"><a href="#cb2-638" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-639"><a href="#cb2-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-640"><a href="#cb2-640" aria-hidden="true" tabindex="-1"></a>In Figure \@ref(fig:distribution-by-comorbidities) we can see that the majority of the population had no comorbidities (&gt; 99%).</span>
<span id="cb2-641"><a href="#cb2-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-642"><a href="#cb2-642" aria-hidden="true" tabindex="-1"></a><span class="fu">### Samples distributed by lab</span></span>
<span id="cb2-643"><a href="#cb2-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-644"><a href="#cb2-644" aria-hidden="true" tabindex="-1"></a>Another layer of granularity is the age distribution per lab. This could be helpful if we are trying to include only labs with an age distribution similar to the non-sequenced people. This is shown in Figure \@ref(fig:samples-per-lab):</span>
<span id="cb2-645"><a href="#cb2-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-646"><a href="#cb2-646" aria-hidden="true" tabindex="-1"></a><span class="in">```{r samples-per-lab, fig.cap="Age distribution of samples collected by each lab."}</span></span>
<span id="cb2-647"><a href="#cb2-647" aria-hidden="true" tabindex="-1"></a> final.data.cleaned <span class="sc">%&gt;%</span> </span>
<span id="cb2-648"><a href="#cb2-648" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(Sequenced <span class="sc">==</span> <span class="st">"Sequenced"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-649"><a href="#cb2-649" aria-hidden="true" tabindex="-1"></a>        <span class="co"># filter(Lineage.Short %in% common.lineages) %&gt;% </span></span>
<span id="cb2-650"><a href="#cb2-650" aria-hidden="true" tabindex="-1"></a>        <span class="co"># mutate(Sample.Date = as.Date(Collection.Date)) %&gt;% </span></span>
<span id="cb2-651"><a href="#cb2-651" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(Performing.Facility, Age, Lineage) <span class="sc">%&gt;%</span></span>
<span id="cb2-652"><a href="#cb2-652" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarise</span>(<span class="at">Number.of.lineages =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb2-653"><a href="#cb2-653" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(Number.of.lineages <span class="sc">&gt;</span> <span class="dv">30</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-654"><a href="#cb2-654" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Age, <span class="at">fill =</span> Lineage)) <span class="sc">+</span> </span>
<span id="cb2-655"><a href="#cb2-655" aria-hidden="true" tabindex="-1"></a>               <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">10</span>) <span class="sc">+</span> </span>
<span id="cb2-656"><a href="#cb2-656" aria-hidden="true" tabindex="-1"></a>               <span class="fu">facet_wrap</span>(Performing.Facility <span class="sc">~</span> .) </span>
<span id="cb2-657"><a href="#cb2-657" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-658"><a href="#cb2-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-659"><a href="#cb2-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-660"><a href="#cb2-660" aria-hidden="true" tabindex="-1"></a><span class="fu">## Distribution of samples over time</span></span>
<span id="cb2-661"><a href="#cb2-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-662"><a href="#cb2-662" aria-hidden="true" tabindex="-1"></a>One more way to look at the data is to see how it is distributed over time, regardless of the age of the population. In particular, we can look at the distribution of cases per lineage sequenced, the hospitalisations and deaths</span>
<span id="cb2-663"><a href="#cb2-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-664"><a href="#cb2-664" aria-hidden="true" tabindex="-1"></a><span class="fu">### Number of cases sequenced by lineage</span></span>
<span id="cb2-665"><a href="#cb2-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-666"><a href="#cb2-666" aria-hidden="true" tabindex="-1"></a>We can also plot the lineage evolution over time. We can do it per week for each variant count in Figure \@ref(fig:lineage-over-time-N):</span>
<span id="cb2-667"><a href="#cb2-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-668"><a href="#cb2-668" aria-hidden="true" tabindex="-1"></a><span class="in">```{r lineage-over-time-N, fig.cap = "Weekly total count of lineages sequenced. Only those lineages with 500 records or more in the entire dataset are shown."}</span></span>
<span id="cb2-669"><a href="#cb2-669" aria-hidden="true" tabindex="-1"></a>startDate <span class="ot">&lt;-</span> <span class="st">"2021-07-01"</span></span>
<span id="cb2-670"><a href="#cb2-670" aria-hidden="true" tabindex="-1"></a> final.data.cleaned <span class="sc">%&gt;%</span> </span>
<span id="cb2-671"><a href="#cb2-671" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Lineage <span class="sc">%in%</span> common.lineages,</span>
<span id="cb2-672"><a href="#cb2-672" aria-hidden="true" tabindex="-1"></a>         Collection.Date <span class="sc">&gt;=</span> startDate) <span class="sc">%&gt;%</span> </span>
<span id="cb2-673"><a href="#cb2-673" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(Lineage, year_month) <span class="sc">%&gt;%</span></span>
<span id="cb2-674"><a href="#cb2-674" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Number.of.lineages =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb2-675"><a href="#cb2-675" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb2-676"><a href="#cb2-676" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year_month, <span class="at">y =</span> Number.of.lineages, <span class="at">fill =</span> Lineage)) <span class="sc">+</span></span>
<span id="cb2-677"><a href="#cb2-677" aria-hidden="true" tabindex="-1"></a>          <span class="co"># geom_line(lwd = 1) + </span></span>
<span id="cb2-678"><a href="#cb2-678" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"stack"</span>, <span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span> </span>
<span id="cb2-679"><a href="#cb2-679" aria-hidden="true" tabindex="-1"></a>          <span class="fu">xlab</span>(<span class="st">"Date"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Number of people sequenced"</span>) <span class="sc">+</span> </span>
<span id="cb2-680"><a href="#cb2-680" aria-hidden="true" tabindex="-1"></a>          <span class="fu">ggtitle</span>(<span class="st">"Total number of monthly lineages sequenced"</span>) <span class="sc">+</span> </span>
<span id="cb2-681"><a href="#cb2-681" aria-hidden="true" tabindex="-1"></a>          <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Lineage"</span>) <span class="sc">+</span> </span>
<span id="cb2-682"><a href="#cb2-682" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_date</span>(<span class="at">date_breaks =</span> <span class="st">"2 months"</span>, <span class="at">date_labels =</span> <span class="st">"%b %Y"</span>)</span>
<span id="cb2-683"><a href="#cb2-683" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-684"><a href="#cb2-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-685"><a href="#cb2-685" aria-hidden="true" tabindex="-1"></a>Another way to visualize better which variant is taking over and when is to visualize this as a percentage. This is show in Figure \@ref(fig:lineage-over-time-perc):</span>
<span id="cb2-686"><a href="#cb2-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-687"><a href="#cb2-687" aria-hidden="true" tabindex="-1"></a><span class="in">```{r lineage-over-time-perc, fig.cap = "Weekly percentage of lineages sequenced. Only those lineages with 500 records or more in the entire dataset are shown."}</span></span>
<span id="cb2-688"><a href="#cb2-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-689"><a href="#cb2-689" aria-hidden="true" tabindex="-1"></a> final.data.cleaned <span class="sc">%&gt;%</span> </span>
<span id="cb2-690"><a href="#cb2-690" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Lineage <span class="sc">%in%</span> common.lineages,</span>
<span id="cb2-691"><a href="#cb2-691" aria-hidden="true" tabindex="-1"></a>         Collection.Date <span class="sc">&gt;=</span> startDate) <span class="sc">%&gt;%</span> </span>
<span id="cb2-692"><a href="#cb2-692" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(Lineage, year_week) <span class="sc">%&gt;%</span></span>
<span id="cb2-693"><a href="#cb2-693" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Number.of.lineages =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb2-694"><a href="#cb2-694" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb2-695"><a href="#cb2-695" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year_week, <span class="at">y =</span> Number.of.lineages, <span class="at">fill =</span> Lineage)) <span class="sc">+</span></span>
<span id="cb2-696"><a href="#cb2-696" aria-hidden="true" tabindex="-1"></a>          <span class="co"># geom_line(lwd = 1) + </span></span>
<span id="cb2-697"><a href="#cb2-697" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"fill"</span>, <span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span> </span>
<span id="cb2-698"><a href="#cb2-698" aria-hidden="true" tabindex="-1"></a>          <span class="fu">xlab</span>(<span class="st">"Date"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Number of people sequenced"</span>) <span class="sc">+</span> </span>
<span id="cb2-699"><a href="#cb2-699" aria-hidden="true" tabindex="-1"></a>          <span class="fu">ggtitle</span>(<span class="st">"Evolution of lineages sequenced over time"</span>) <span class="sc">+</span> </span>
<span id="cb2-700"><a href="#cb2-700" aria-hidden="true" tabindex="-1"></a>          <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Lineage"</span>) <span class="sc">+</span> </span>
<span id="cb2-701"><a href="#cb2-701" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_date</span>(<span class="at">date_breaks =</span> <span class="st">"2 months"</span>, <span class="at">date_labels =</span> <span class="st">"%b %Y"</span>)</span>
<span id="cb2-702"><a href="#cb2-702" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-703"><a href="#cb2-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-704"><a href="#cb2-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-705"><a href="#cb2-705" aria-hidden="true" tabindex="-1"></a><span class="fu">### Number of hospitalizations </span></span>
<span id="cb2-706"><a href="#cb2-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-707"><a href="#cb2-707" aria-hidden="true" tabindex="-1"></a>One thing we can do is to summarise per month the number of people tested positive, hospitalized and deaths to compare with the sequenced data. The weekly hospitalisations are shown in Figure \@ref(fig:biweekly-hospitalisations):</span>
<span id="cb2-708"><a href="#cb2-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-709"><a href="#cb2-709" aria-hidden="true" tabindex="-1"></a><span class="in">```{r biweekly-hospitalisations, fig.cap="Bi-weekly percentage of hospitalisation people per sequencing status."}</span></span>
<span id="cb2-710"><a href="#cb2-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-711"><a href="#cb2-711" aria-hidden="true" tabindex="-1"></a>final.data.cleaned <span class="sc">%&gt;%</span> </span>
<span id="cb2-712"><a href="#cb2-712" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(Sequenced == "Sequenced") %&gt;% </span></span>
<span id="cb2-713"><a href="#cb2-713" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mutate(hospitalized = factor(ifelse(!is.na(Date_hospitalization), 1, 0)), Sequenced = factor(Sequenced), Death = factor(IsDied)) %&gt;%</span></span>
<span id="cb2-714"><a href="#cb2-714" aria-hidden="true" tabindex="-1"></a>    <span class="co"># # filter(Reason.for.Sequencing == "Community Surveillance") %&gt;%</span></span>
<span id="cb2-715"><a href="#cb2-715" aria-hidden="true" tabindex="-1"></a>    <span class="co"># select(PseudoID, CollectionDateTime, week, month,  hospitalized, Date_hospitalization, hospital_discharge_date, IsDied) %&gt;%</span></span>
<span id="cb2-716"><a href="#cb2-716" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(year_month,</span>
<span id="cb2-717"><a href="#cb2-717" aria-hidden="true" tabindex="-1"></a>             Hospitalised, Sequenced, Reason.for.Sequencing) <span class="sc">%&gt;%</span> </span>
<span id="cb2-718"><a href="#cb2-718" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mutate(Sequenced = fct_relevel(factor(Sequenced), c("Not Sequenced", "Sequenced"))) %&gt;% </span></span>
<span id="cb2-719"><a href="#cb2-719" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2-720"><a href="#cb2-720" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mutate(week_dt = as.Date(paste0(year,"-",ifelse(month&lt;10, "0",""),month,"-","01"))) %&gt;% </span></span>
<span id="cb2-721"><a href="#cb2-721" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year_month, <span class="at">y =</span> n, <span class="at">fill =</span> Hospitalised)) <span class="sc">+</span> </span>
<span id="cb2-722"><a href="#cb2-722" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"fill"</span>, <span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">colour=</span><span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb2-723"><a href="#cb2-723" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_x_date</span>(<span class="at">limits =</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">"2021-09-01"</span>,<span class="st">"2022-09-30"</span>))) <span class="sc">+</span></span>
<span id="cb2-724"><a href="#cb2-724" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb2-725"><a href="#cb2-725" aria-hidden="true" tabindex="-1"></a>          <span class="fu">xlab</span>(<span class="st">"Date (month)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"% of people"</span>) <span class="sc">+</span> </span>
<span id="cb2-726"><a href="#cb2-726" aria-hidden="true" tabindex="-1"></a>          <span class="fu">facet_grid</span>(Reason.for.Sequencing <span class="sc">~</span> Sequenced) <span class="sc">+</span></span>
<span id="cb2-727"><a href="#cb2-727" aria-hidden="true" tabindex="-1"></a>          <span class="co"># scale_fill_discrete(name = "Hospitalized") +</span></span>
<span id="cb2-728"><a href="#cb2-728" aria-hidden="true" tabindex="-1"></a>          <span class="fu">ggtitle</span>(<span class="st">"Hospitalization percentage per Sequencing status"</span>) <span class="sc">+</span></span>
<span id="cb2-729"><a href="#cb2-729" aria-hidden="true" tabindex="-1"></a>          <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>) </span>
<span id="cb2-730"><a href="#cb2-730" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-731"><a href="#cb2-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-732"><a href="#cb2-732" aria-hidden="true" tabindex="-1"></a>As shown in Figure \@ref(fig:biweekly-hospitalisations), it is clear that the proportion of people hospitalised from sequenced people is higher than those from people who are not sequenced. Therefore, a direct estimation from the sequenced data only will estimate a higher hospitalisation rate for each variant studied and therefore it is required to adjust for that bias.  </span>
<span id="cb2-733"><a href="#cb2-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-734"><a href="#cb2-734" aria-hidden="true" tabindex="-1"></a><span class="fu">### Number of deaths</span></span>
<span id="cb2-735"><a href="#cb2-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-736"><a href="#cb2-736" aria-hidden="true" tabindex="-1"></a>The number of deaths per sequencing status is shown in Figure \@ref(fig:biweekly-deaths):</span>
<span id="cb2-737"><a href="#cb2-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-738"><a href="#cb2-738" aria-hidden="true" tabindex="-1"></a><span class="in">```{r biweekly-deaths, fig.cap="Bi-weekly percentage of deaths by sequenced status."}</span></span>
<span id="cb2-739"><a href="#cb2-739" aria-hidden="true" tabindex="-1"></a>final.data.cleaned <span class="sc">%&gt;%</span> </span>
<span id="cb2-740"><a href="#cb2-740" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(Sequenced == "Sequenced") %&gt;% </span></span>
<span id="cb2-741"><a href="#cb2-741" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(year_month,</span>
<span id="cb2-742"><a href="#cb2-742" aria-hidden="true" tabindex="-1"></a>             Sequenced, Death) <span class="sc">%&gt;%</span> </span>
<span id="cb2-743"><a href="#cb2-743" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mutate(Sequenced = fct_relevel(factor(Sequenced), c("Not Sequenced", "Sequenced"))) %&gt;% </span></span>
<span id="cb2-744"><a href="#cb2-744" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2-745"><a href="#cb2-745" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mutate(week_dt = as.Date(paste0(year,"-",ifelse(month&lt;10, "0",""),month,"-","01"))) %&gt;% </span></span>
<span id="cb2-746"><a href="#cb2-746" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span>year_month, <span class="at">y =</span> n, <span class="at">fill =</span> Death)) <span class="sc">+</span> </span>
<span id="cb2-747"><a href="#cb2-747" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"fill"</span>, <span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb2-748"><a href="#cb2-748" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_x_date</span>(<span class="at">limits =</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">"2021-09-01"</span>,<span class="st">"2022-09-30"</span>))) <span class="sc">+</span></span>
<span id="cb2-749"><a href="#cb2-749" aria-hidden="true" tabindex="-1"></a>          <span class="co"># scale_y_continuous(breaks=seq(0,1, by = 0.2)) +</span></span>
<span id="cb2-750"><a href="#cb2-750" aria-hidden="true" tabindex="-1"></a>          <span class="fu">xlab</span>(<span class="st">"Date (month)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"# of people"</span>) <span class="sc">+</span> </span>
<span id="cb2-751"><a href="#cb2-751" aria-hidden="true" tabindex="-1"></a>          <span class="fu">facet_grid</span>(. <span class="sc">~</span> Sequenced) <span class="sc">+</span></span>
<span id="cb2-752"><a href="#cb2-752" aria-hidden="true" tabindex="-1"></a>          <span class="co"># scale_fill_discrete(name = "Hospitalized") +</span></span>
<span id="cb2-753"><a href="#cb2-753" aria-hidden="true" tabindex="-1"></a>          <span class="fu">ggtitle</span>(<span class="st">"Death percentage per Sequencing status"</span>) <span class="sc">+</span></span>
<span id="cb2-754"><a href="#cb2-754" aria-hidden="true" tabindex="-1"></a>          <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span>
<span id="cb2-755"><a href="#cb2-755" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-756"><a href="#cb2-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-757"><a href="#cb2-757" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary table of totals</span></span>
<span id="cb2-758"><a href="#cb2-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-759"><a href="#cb2-759" aria-hidden="true" tabindex="-1"></a>A table summary for variants and reason for sequencing is shown in Table \@ref(tab:table-by-variant):</span>
<span id="cb2-760"><a href="#cb2-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-761"><a href="#cb2-761" aria-hidden="true" tabindex="-1"></a><span class="in">```{r table-by-variant}</span></span>
<span id="cb2-762"><a href="#cb2-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-763"><a href="#cb2-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-764"><a href="#cb2-764" aria-hidden="true" tabindex="-1"></a>summary.variants <span class="ot">&lt;-</span> final.data.cleaned <span class="sc">%&gt;%</span>  </span>
<span id="cb2-765"><a href="#cb2-765" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(Sequenced == "Sequenced") %&gt;%             </span></span>
<span id="cb2-766"><a href="#cb2-766" aria-hidden="true" tabindex="-1"></a>          <span class="fu">group_by</span>(Reason.for.Sequencing, Lineage) <span class="sc">%&gt;%</span> </span>
<span id="cb2-767"><a href="#cb2-767" aria-hidden="true" tabindex="-1"></a>          <span class="fu">summarise</span>(<span class="at">Number.of.cases =</span> <span class="fu">n</span>(),</span>
<span id="cb2-768"><a href="#cb2-768" aria-hidden="true" tabindex="-1"></a>                    <span class="at">Number.of.hospitalised =</span> <span class="fu">sum</span>(Hospitalised <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb2-769"><a href="#cb2-769" aria-hidden="true" tabindex="-1"></a>                    <span class="at">Number.of.Deaths =</span> <span class="fu">sum</span>(Death <span class="sc">==</span> <span class="dv">1</span>), </span>
<span id="cb2-770"><a href="#cb2-770" aria-hidden="true" tabindex="-1"></a>                    <span class="at">Number.of.ICUs =</span> <span class="fu">sum</span>(Tableau.ICU.Status <span class="sc">==</span> <span class="st">"ICU"</span> <span class="sc">|</span> Tableau.ICU.Status <span class="sc">==</span> <span class="st">"HDU"</span>)) </span>
<span id="cb2-771"><a href="#cb2-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-772"><a href="#cb2-772" aria-hidden="true" tabindex="-1"></a>summary.variants <span class="sc">%&gt;%</span> </span>
<span id="cb2-773"><a href="#cb2-773" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(Number.of.cases <span class="sc">&gt;</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-774"><a href="#cb2-774" aria-hidden="true" tabindex="-1"></a>  <span class="co"># recode_factor(NA = "Sequenced") %&gt;%</span></span>
<span id="cb2-775"><a href="#cb2-775" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">booktabs =</span> T, <span class="at">escape =</span> F, <span class="at">format.args =</span> <span class="fu">list</span>(<span class="at">big.mark =</span> <span class="st">","</span>),</span>
<span id="cb2-776"><a href="#cb2-776" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"Number of cases, hospitalisations and death per lineage and reason for sequencing. NAs correspond to the values of not sequenced people."</span>),</span>
<span id="cb2-777"><a href="#cb2-777" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Reason for Sequencing"</span>, <span class="st">"Lineage"</span>, <span class="st">"Number of cases"</span>, </span>
<span id="cb2-778"><a href="#cb2-778" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"Number of hospitalisations"</span>, <span class="st">"Number of deaths"</span>, <span class="st">"Number of ICUs"</span>),</span>
<span id="cb2-779"><a href="#cb2-779" aria-hidden="true" tabindex="-1"></a>                                  <span class="co"># width = 12,</span></span>
<span id="cb2-780"><a href="#cb2-780" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">align =</span> <span class="fu">c</span>(<span class="st">'l'</span>,<span class="fu">rep</span>(<span class="st">'c'</span>, <span class="fu">ncol</span>(summary.variants)<span class="sc">-</span><span class="dv">1</span>)))  <span class="sc">%&gt;%</span></span>
<span id="cb2-781"><a href="#cb2-781" aria-hidden="true" tabindex="-1"></a>                                  <span class="co"># row_spec(0, bold=TRUE)</span></span>
<span id="cb2-782"><a href="#cb2-782" aria-hidden="true" tabindex="-1"></a>                           kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="fu">c</span>(<span class="st">"striped"</span>,<span class="st">"hover"</span>), <span class="at">full_width =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb2-783"><a href="#cb2-783" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">column_spec</span>(<span class="at">column =</span> <span class="dv">1</span>, <span class="at">extra_css =</span> <span class="st">"position: absolute"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-784"><a href="#cb2-784" aria-hidden="true" tabindex="-1"></a>                           <span class="co"># column_spec(column = 1:length(colnames_allTable), width = "12em; min-width: 8em;") %&gt;%</span></span>
<span id="cb2-785"><a href="#cb2-785" aria-hidden="true" tabindex="-1"></a>                           kableExtra<span class="sc">::</span><span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"100%"</span>, <span class="at">fixed_thead =</span> T)</span>
<span id="cb2-786"><a href="#cb2-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-787"><a href="#cb2-787" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-788"><a href="#cb2-788" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-789"><a href="#cb2-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-790"><a href="#cb2-790" aria-hidden="true" tabindex="-1"></a>From summary Table \@ref(tab:table-by-variant) a weighted average of the hospitalisation and death rate for each variant can be obtained and then compared it to the non-sequenced data. Given that the number of records of the community surveillance is substantially much higher than the rest of the groups, it could be advisable to use only community surveillance data only.</span>
<span id="cb2-791"><a href="#cb2-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-792"><a href="#cb2-792" aria-hidden="true" tabindex="-1"></a>It can be seen that some of the records labeled as ICU did not match their hospitalisation flag. Therefore this needs to be corrected in the raw data as well.</span>
<span id="cb2-793"><a href="#cb2-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-794"><a href="#cb2-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-795"><a href="#cb2-795" aria-hidden="true" tabindex="-1"></a><span class="fu">## Time evolution of daily cases curve</span></span>
<span id="cb2-796"><a href="#cb2-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-797"><a href="#cb2-797" aria-hidden="true" tabindex="-1"></a>A final check that we are looking at similar data sources can be a comparison between the totals reported during the pandemic and the cases recorded after cleaning the data in this study. This is show in Figure \@ref(fig:comparison-with-estijaba):</span>
<span id="cb2-798"><a href="#cb2-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-799"><a href="#cb2-799" aria-hidden="true" tabindex="-1"></a><span class="in">```{r comparison-with-estijaba, fig.cap="Number of cases over time for two different data sources, namely this study and totals reported by Estijaba."}</span></span>
<span id="cb2-800"><a href="#cb2-800" aria-hidden="true" tabindex="-1"></a>daily.cases <span class="ot">&lt;-</span> final.data.cleaned <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Collection.Date) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">nCases =</span> <span class="fu">n</span>()) </span>
<span id="cb2-801"><a href="#cb2-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-802"><a href="#cb2-802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-803"><a href="#cb2-803" aria-hidden="true" tabindex="-1"></a>xlsDailyCases <span class="ot">&lt;-</span> <span class="st">"./data-provided/20230111-daily-cases-AD.xlsx"</span></span>
<span id="cb2-804"><a href="#cb2-804" aria-hidden="true" tabindex="-1"></a>daily.cases.Estijaba <span class="ot">&lt;-</span> openxlsx<span class="sc">::</span><span class="fu">read.xlsx</span>(xlsDailyCases)</span>
<span id="cb2-805"><a href="#cb2-805" aria-hidden="true" tabindex="-1"></a>daily.cases.Estijaba <span class="ot">&lt;-</span> daily.cases.Estijaba <span class="sc">%&gt;%</span> <span class="fu">select</span>(Date, CASES) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Collection.Date =</span> <span class="fu">excel_numeric_to_date</span>(Date), <span class="at">CASES =</span> <span class="fu">as.numeric</span>(CASES)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>Date)</span>
<span id="cb2-806"><a href="#cb2-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-807"><a href="#cb2-807" aria-hidden="true" tabindex="-1"></a>rollmean_days <span class="ot">&lt;-</span> <span class="dv">7</span></span>
<span id="cb2-808"><a href="#cb2-808" aria-hidden="true" tabindex="-1"></a>daily.cases.joined <span class="ot">&lt;-</span> <span class="fu">left_join</span>(daily.cases, daily.cases.Estijaba, <span class="at">by =</span>  <span class="st">"Collection.Date"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-809"><a href="#cb2-809" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">rename</span>(<span class="at">Cases.This.Study=</span>nCases, <span class="at">Cases.Estijaba =</span> CASES) <span class="sc">%&gt;%</span></span>
<span id="cb2-810"><a href="#cb2-810" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">mutate</span>(<span class="at">Cases.This.Study.smoothed =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="cn">NA</span>, rollmean_days<span class="dv">-1</span>), zoo<span class="sc">::</span><span class="fu">rollmean</span>(Cases.This.Study, <span class="at">k =</span> rollmean_days)),</span>
<span id="cb2-811"><a href="#cb2-811" aria-hidden="true" tabindex="-1"></a>                             <span class="at">Cases.Estijaba.smoothed =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="cn">NA</span>, rollmean_days<span class="dv">-1</span>), zoo<span class="sc">::</span><span class="fu">rollmean</span>(Cases.Estijaba, <span class="at">k =</span> rollmean_days))) <span class="sc">%&gt;%</span>  </span>
<span id="cb2-812"><a href="#cb2-812" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(Cases.This.Study.smoothed, Cases.Estijaba.smoothed), <span class="at">names_to =</span> <span class="st">"Data.Source"</span>, <span class="at">values_to =</span> <span class="st">"nCases"</span>)</span>
<span id="cb2-813"><a href="#cb2-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-814"><a href="#cb2-814" aria-hidden="true" tabindex="-1"></a>daily.cases.joined <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(Collection.Date, nCases, <span class="at">color =</span> <span class="fu">factor</span>(Data.Source))) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb2-815"><a href="#cb2-815" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">xlab</span>(<span class="st">"Collection Date"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"# Cases"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Data Source"</span>) <span class="sc">+</span> </span>
<span id="cb2-816"><a href="#cb2-816" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">scale_color_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">'# Cases Estijaba'</span>, <span class="st">'# Cases This Study'</span>)) <span class="sc">+</span> </span>
<span id="cb2-817"><a href="#cb2-817" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">ggtitle</span>(<span class="st">"Evolution of cases over time for different data sources"</span>)</span>
<span id="cb2-818"><a href="#cb2-818" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-819"><a href="#cb2-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-820"><a href="#cb2-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-821"><a href="#cb2-821" aria-hidden="true" tabindex="-1"></a>Since the number of sequenced for the delta variant appears to be somehow very large, we can plot the number of cases per variant over time. This is shown in Figure \@ref(fig:comparison-with-estijaba-lineages):</span>
<span id="cb2-822"><a href="#cb2-822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-823"><a href="#cb2-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-824"><a href="#cb2-824" aria-hidden="true" tabindex="-1"></a><span class="in">```{r comparison-with-estijaba-lineages, fig.cap="Number of cases over time for two different data sources, namely this study and totals reported by Estijaba."}</span></span>
<span id="cb2-825"><a href="#cb2-825" aria-hidden="true" tabindex="-1"></a>daily.cases.lineage <span class="ot">&lt;-</span> final.data.cleaned <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Collection.Date, Lineage) <span class="sc">%&gt;%</span> </span>
<span id="cb2-826"><a href="#cb2-826" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">summarise</span>(<span class="at">nCases =</span> <span class="fu">n</span>(), </span>
<span id="cb2-827"><a href="#cb2-827" aria-hidden="true" tabindex="-1"></a>                                                        <span class="at">nCases.smoothed =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="cn">NA</span>, rollmean_days<span class="dv">-1</span>), zoo<span class="sc">::</span><span class="fu">rollmean</span>(<span class="fu">n</span>(), <span class="at">k =</span> rollmean_days))) </span>
<span id="cb2-828"><a href="#cb2-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-829"><a href="#cb2-829" aria-hidden="true" tabindex="-1"></a>daily.cases.lineage <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Lineage <span class="sc">%in%</span> common.lineages) <span class="sc">%&gt;%</span> </span>
<span id="cb2-830"><a href="#cb2-830" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Collection.Date, nCases, <span class="at">color =</span> Lineage)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb2-831"><a href="#cb2-831" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">xlab</span>(<span class="st">"Collection Date"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"# Cases"</span>)</span>
<span id="cb2-832"><a href="#cb2-832" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-833"><a href="#cb2-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-834"><a href="#cb2-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-835"><a href="#cb2-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-836"><a href="#cb2-836" aria-hidden="true" tabindex="-1"></a><span class="in">```{r recovered-cases-per-variant}</span></span>
<span id="cb2-837"><a href="#cb2-837" aria-hidden="true" tabindex="-1"></a><span class="co"># final.data.cleaned %&gt;% filter(Sequenced == "Sequenced") %&gt;% group_by(Lineage) %&gt;% </span></span>
<span id="cb2-838"><a href="#cb2-838" aria-hidden="true" tabindex="-1"></a>                       <span class="co"># summarise(Number.of.cases = n(),</span></span>
<span id="cb2-839"><a href="#cb2-839" aria-hidden="true" tabindex="-1"></a>                       <span class="co">#           Number.of.hospitalised = sum(Hospitalised == 1),</span></span>
<span id="cb2-840"><a href="#cb2-840" aria-hidden="true" tabindex="-1"></a>                       <span class="co">#           Number.of.Deaths = sum(Death == 1), </span></span>
<span id="cb2-841"><a href="#cb2-841" aria-hidden="true" tabindex="-1"></a>                       <span class="co">#           Number.of.ICUs = sum(Tableau.ICU.Status == "ICU" | Tableau.ICU.Status == "HDU")) %&gt;%</span></span>
<span id="cb2-842"><a href="#cb2-842" aria-hidden="true" tabindex="-1"></a>                       <span class="co">#                      filter(Number.of.cases &gt; 100)</span></span>
<span id="cb2-843"><a href="#cb2-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-844"><a href="#cb2-844" aria-hidden="true" tabindex="-1"></a><span class="co"># daily.cases.Estijaba %&gt;% filter()</span></span>
<span id="cb2-845"><a href="#cb2-845" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-846"><a href="#cb2-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-847"><a href="#cb2-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-848"><a href="#cb2-848" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Made with <a href="https://quarto.org">Quarto</a></div>   
    <div class="nav-footer-center"><a href="mailto:maupagas@gmail.com">Contact Mauricio Patón</a></div>
    <div class="nav-footer-right"><a href="https://github.com/mauricio-online-portfolio">Github Code Repo</a></div>
  </div>
</footer>



</body></html>